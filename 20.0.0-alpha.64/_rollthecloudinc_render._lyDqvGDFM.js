import { a as ce } from "@nf-internal/chunk-VJMH5IEE";
import { g as ie, i as Se } from "@nf-internal/chunk-FYX6O4YR";
import { H as B, M as qe, f as ke, k as D, l as O, z as A } from "@nf-internal/chunk-STIBVO4O";
import { a as M, b as Q, i as Ve } from "@nf-internal/chunk-2AVGQ2MQ";
import * as W from "@angular/common";
import { isPlatformServer as Be, isPlatformBrowser as de, CommonModule as yt } from "@angular/common";
import * as e from "@angular/core";
import { InjectionToken as Je, forwardRef as X, DOCUMENT as et, PLATFORM_ID as Re, EventEmitter as tt, inject as Ct, Injector as Pt } from "@angular/core";
import * as w from "@angular/forms";
import { NG_VALUE_ACCESSOR as ve, Validators as bt, NG_ASYNC_VALIDATORS as Ee, FormsModule as xt, ReactiveFormsModule as St } from "@angular/forms";
import * as se from "@rollthecloudinc/utils";
import { UtilsModule as It, EMBEDDABLE_COMPONENT as _t } from "@rollthecloudinc/utils";
import * as it from "@rollthecloudinc/layout";
import { GridLayoutComponent as $t, LayoutModule as wt } from "@rollthecloudinc/layout";
import * as nt from "@rollthecloudinc/media";
import { MEDIA_SETTINGS as Ft } from "@rollthecloudinc/media";
import * as re from "@rollthecloudinc/detour";
import { resolveHandlerParams as Rt, InteractionHandlerPlugin as je } from "@rollthecloudinc/detour";
import * as oe from "@rollthecloudinc/context";
import { InlineContext as Me } from "@rollthecloudinc/context";
import * as F from "@rollthecloudinc/panels";
import { PanelPageStateSlice as Ue, PanelPage as Ie, PanelPageForm as Ge, PanelsModule as Et } from "@rollthecloudinc/panels";
import { tap as h, map as d, filter as T, switchMap as I, withLatestFrom as Qe, take as U, defaultIfEmpty as ue, delay as ne, startWith as Ne, debounceTime as Z, distinctUntilChanged as jt, skip as _e, bufferTime as Mt, takeUntil as Nt, concatMap as We, catchError as Tt, finalize as Ot } from "rxjs/operators";
import { getRouterSelectors as ze } from "@ngrx/router-store";
import * as Te from "@ngrx/store";
import { select as Ye } from "@ngrx/store";
import * as ye from "@rollthecloudinc/sheath";
import { isSelectorValid as ge, ClassClassification as Oe } from "@rollthecloudinc/sheath";
import { camelize as st } from "inflected";
import $e from "deepmerge-json";
import * as rt from "@angular/router";
import { BaseRouteReuseStrategy as Dt, RouteReuseStrategy as At } from "@angular/router";
import * as De from "@rollthecloudinc/crud";
import * as ee from "@ngrx/data";
import * as ot from "@rollthecloudinc/rules";
import * as Ae from "@rollthecloudinc/content";
import * as Le from "@rollthecloudinc/dparam";
import * as at from "@angular/common/http";
import * as lt from "@rollthecloudinc/attributes";
import * as He from "@rollthecloudinc/refinery";
import * as ct from "@rollthecloudinc/auth";
import * as Ce from "@angular/material/button";
import * as dt from "@angular/material/icon";
import * as K from "@angular/material/dialog";
import { MAT_DIALOG_DATA as Lt } from "@angular/material/dialog";
import { ComponentPortal as Ht } from "@angular/cdk/portal";
import { MaterialModule as Vt } from "@rollthecloudinc/material";
import * as pt from "@angular/cdk/overlay";
function kt(n, a) { }
function qt(n, a) { if (n & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page", 5), n & 2) {
    let t = e.\u0275\u0275nextContext();
    e.\u0275\u0275property("panelPage", t.panelPage)("nested", !0)("contexts", t.contexts)("css", t.filteredCss)("listeners", t.filteredListeners)("ancestory", t.ancestoryWithSelf);
} }
function Bt(n, a) { if (n & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page", 6), n & 2) {
    let t = e.\u0275\u0275nextContext();
    e.\u0275\u0275property("id", t.linkedPageId)("nested", !0)("contexts", t.contexts)("ancestory", t.ancestoryWithSelf);
} }
function Ut(n, a) { if (n & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page", 5), n & 2) {
    let t = e.\u0275\u0275nextContext();
    e.\u0275\u0275property("panelPage", t.embedPanel)("nested", !0)("contexts", t.contexts)("css", t.filteredCss)("listeners", t.filteredListeners)("ancestory", t.ancestoryWithSelf);
} }
function Gt(n, a) { n & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page-router"); }
var Qt = ["panes"];
function Wt(n, a) { }
function zt(n, a) { if (n & 1 && e.\u0275\u0275element(0, "classifieds-ui-render-pane", 8), n & 2) {
    let t = a.$implicit, i = a.index, s = e.\u0275\u0275nextContext(3), p = e.\u0275\u0275reference(1);
    e.\u0275\u0275property("formControlName", i)("pluginName", t.contentPlugin)("settings", t.settings)("name", t.name)("label", t.label)("originPane", s.panel.panes[s.originMappings[i]])("contexts", t.contexts)("displayType", s.displayType)("resolvedContext", t.resolvedContext)("indexPosition", i)("css", s.filteredCss)("listeners", s.filteredListeners)("ancestory", s.ancestoryWithSelf$.value)("panes", p)("originPanes", s.originPanes);
} }
function Yt(n, a) { if (n & 1 && (e.\u0275\u0275elementContainerStart(0)(1)(2, 6), e.\u0275\u0275template(3, zt, 1, 15, "classifieds-ui-render-pane", 7), e.\u0275\u0275elementContainerEnd()()()), n & 2) {
    let t = e.\u0275\u0275nextContext(2);
    e.\u0275\u0275advance(3), e.\u0275\u0275property("ngForOf", t.resolvedPanes);
} }
function Xt(n, a) { if (n & 1 && e.\u0275\u0275element(0, "classifieds-ui-render-pane", 10), n & 2) {
    let t = a.$implicit, i = a.index, s = e.\u0275\u0275nextContext(3), p = e.\u0275\u0275reference(1);
    e.\u0275\u0275property("pluginName", t.contentPlugin)("settings", t.settings)("name", t.name)("label", t.label)("originPane", s.panel.panes[s.originMappings[i]])("contexts", t.contexts)("linkedPageId", t.linkedPageId)("displayType", s.displayType)("resolvedContext", t.resolvedContext)("indexPosition", i)("css", s.filteredCss)("listeners", s.filteredListeners)("ancestory", s.ancestoryWithSelf$.value)("panes", p)("originPanes", s.originPanes);
} }
function Kt(n, a) { if (n & 1 && (e.\u0275\u0275elementContainerStart(0), e.\u0275\u0275template(1, Xt, 1, 15, "classifieds-ui-render-pane", 9), e.\u0275\u0275elementContainerEnd()), n & 2) {
    let t = e.\u0275\u0275nextContext(2);
    e.\u0275\u0275advance(), e.\u0275\u0275property("ngForOf", t.resolvedPanes);
} }
function Zt(n, a) { if (n & 1 && (e.\u0275\u0275elementContainerStart(0)(1, 4), e.\u0275\u0275template(2, Yt, 4, 1, "ng-container", 5)(3, Kt, 2, 1, "ng-container", 5), e.\u0275\u0275elementContainerEnd()()), n & 2) {
    let t = e.\u0275\u0275nextContext();
    e.\u0275\u0275advance(), e.\u0275\u0275property("ngSwitch", t.displayType), e.\u0275\u0275advance(), e.\u0275\u0275property("ngSwitchCase", "form"), e.\u0275\u0275advance(), e.\u0275\u0275property("ngSwitchCase", "page");
} }
var Jt = ["renderPanelTpl"];
function ei(n, a) { if (n & 1) {
    let t = e.\u0275\u0275getCurrentView();
    e.\u0275\u0275elementStart(0, "button", 4), e.\u0275\u0275listener("click", function () { e.\u0275\u0275restoreView(t); let s = e.\u0275\u0275nextContext(); return e.\u0275\u0275resetView(s.onPreviewClose()); }), e.\u0275\u0275elementStart(1, "mat-icon"), e.\u0275\u0275text(2, "close"), e.\u0275\u0275elementEnd()();
} n & 2 && e.\u0275\u0275attribute("aria-label", "Close Preview"); }
function ti(n, a) { }
function ii(n, a) { if (n & 1 && (e.\u0275\u0275elementContainerStart(0, 2)(1, 5), e.\u0275\u0275element(2, "classifieds-ui-render-panel", 6), e.\u0275\u0275elementContainerEnd()()), n & 2) {
    let t = a.i, i = e.\u0275\u0275nextContext();
    e.\u0275\u0275property("formGroup", i.pageForm), e.\u0275\u0275advance(2), e.\u0275\u0275property("formControlName", t)("panel", i.panelPageCached.panels[t])("nested", i.nested$.value)("contexts", i.contexts$.value)("resolvedContext", i.resolvedContext)("contextsChanged", i.contextsChanged)("displayType", i.panelPageCached.displayType)("indexPosition", t)("css", i.filteredCss)("listeners", i.filteredListeners)("ancestory", i.ancestory$.value);
} }
var fe = (() => { class n {
    constructor(t) { this.viewContainerRef = t; }
    static { this.\u0275fac = function (i) { return new (i || n)(e.\u0275\u0275directiveInject(e.ViewContainerRef)); }; }
    static { this.\u0275dir = e.\u0275\u0275defineDirective({ type: n, selectors: [["", "classifiedsUiPaneContentHost", ""]], standalone: !1 }); }
} return n; })(), Xe = (() => { class n {
    constructor(t) { this.viewContainerRef = t; }
    static { this.\u0275fac = function (i) { return new (i || n)(e.\u0275\u0275directiveInject(e.ViewContainerRef)); }; }
    static { this.\u0275dir = e.\u0275\u0275defineDirective({ type: n, selectors: [["", "classifiedsUiLayoutRendererHost", ""]], standalone: !1 }); }
} return n; })(), Ke = new Je("RenderPaneToken"), Ze = new Je("PanelPageRouterToken"), we = (() => { class n {
    constructor(t, i, s, p, y, N, j, L, q, G) { this.panelPageRouterComponent = t, this.route = i, this.pageBuilderFacade = s, this.routerStore = p, this.asyncApiCallHelperSvc = y, this.crudDataHelperService = N, this.entityDefinitionService = j, this.rulesResolver = L, this.inlineContextResolver = q, this.yield = !!this.panelPageRouterComponent, this.onTouched = () => { }, this.paramMapSub = this.route.paramMap.pipe(h(() => console.log("param map panelPageId")), d(l => l.get("panelPageId")), T(l => l !== void 0), I(() => this.route.data), Qe(this.routerStore.pipe(Ye(ze(l => l.router).selectCurrentRoute), d(l => l.params), U(1))), h(([l, g]) => console.log("panel page router param map", l.panelPageListItem.id, g)), d(([l, g]) => [l.panelPageListItem.id, g, l.path]), h(([l, g, P]) => console.log("panel page router param map 2", l, g, P)), I(([l, g, P]) => this.yield ? A([l, g, void 0]) : this.crudDataHelperService.evaluateCollectionPlugins({ query: void 0, plugins: this.entityDefinitionService.getDefinition("PanelPage").metadata.crud, op: "query" }).pipe(d(f => f.filter(o => o.path === "*")), I(f => !f || f.length === 0 ? (console.log("No decorators found \u2192 no decorator applied."), A(void 0)) : this.inlineContextResolver.resolveMerged([], `router:${ce()}`).pipe(h(o => console.log("router resolved context", o)), I(o => ie(f.map(c => { let v = c.selection?.rule; return v ? this.rulesResolver.evaluate(v, [o]).pipe(d(b => ({ page: c, match: b, priority: c.selection?.priority ?? 0 }))) : A({ page: c, match: !0, priority: c.selection?.priority ?? 0 }); }))), d(o => { let c = o.filter(b => b.match); if (c.length === 0) {
        console.log("Decorators exist, but none matched rules \u2192 no decorator.");
        return;
    } c.sort((b, u) => u.priority - b.priority); let v = c[0].page.id; return console.log("Decorator selected:", v), v; }), U(1))), d(f => [l, g, P, f]), ue([l, g, P, void 0]))), h(([l, g, P, f]) => { let o = "/pages/panelpage/" + l; this.pageBuilderFacade.setPageInfo(new Ue({ id: l, realPath: o, path: P, args: g })), this.panelPageId = l, f !== void 0 && f !== this.routePanelPageId && (this.routePanelPageId = f), console.log("router panelPageId", this.panelPageId), console.log("router routePanelPageId", this.routePanelPageId); })).subscribe(), this.panelPageService = G.getEntityCollectionService("PanelPage"); }
    writeValue(t) { }
    registerOnChange(t) { }
    registerOnTouched(t) { this.onTouched = t; }
    setDisabledState(t) { }
    ngOnInit() { if (!this.yield) {
        let { selectCurrentRoute: t } = ze(i => i.router);
        this.route.paramMap.pipe(h(() => console.log("param map page builder facade info")), Qe(this.pageBuilderFacade.getPageInfo$), T(([i, s]) => s !== void 0 && i.get("panelPageId") !== void 0 && i.get("panelPageId") === s.id), I(([i, s]) => this.routerStore.pipe(Ye(t), d(p => [s, p.params]), U(1)))).subscribe(([i, s]) => this.pageBuilderFacade.setPageInfo(new Ue(Q(M({}, i), { args: s }))));
    } }
    static { this.\u0275fac = function (i) { return new (i || n)(e.\u0275\u0275directiveInject(Ze, 12), e.\u0275\u0275directiveInject(rt.ActivatedRoute), e.\u0275\u0275directiveInject(F.PageBuilderFacade), e.\u0275\u0275directiveInject(Te.Store), e.\u0275\u0275directiveInject(se.AsyncApiCallHelperService), e.\u0275\u0275directiveInject(De.CrudDataHelperService), e.\u0275\u0275directiveInject(ee.EntityDefinitionService), e.\u0275\u0275directiveInject(ot.RulesResolverService), e.\u0275\u0275directiveInject(oe.InlineContextResolverService), e.\u0275\u0275directiveInject(ee.EntityServices)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: n, selectors: [["classifieds-ui-panel-page-router"]], standalone: !1, features: [e.\u0275\u0275ProvidersFeature([{ provide: ve, useExisting: X(() => n), multi: !0 }, { provide: Ze, useExisting: X(() => n) }])], decls: 1, vars: 1, consts: [[3, "id"]], template: function (i, s) { i & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page", 0), i & 2 && e.\u0275\u0275property("id", s.routePanelPageId ?? s.panelPageId); }, dependencies: () => [J], styles: ["[_nghost-%COMP%]{position:relative}.close-preview[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;z-index:10}"] }); }
} return n; })(), me = (() => { class n {
    set resolvedContext(t) { this.resolvedContext$.next(t); }
    set css(t) { this.css$.next(t); }
    set listeners(t) { this.listeners$.next(t); }
    get indexPositionClass() { return `pane-${this.indexPosition}`; }
    get dynamicPanel() { return new Ie(this.resolvedContext._root); }
    constructor(t, i, s, p, y, N, j, L, q, G, l, g, P, f) { this.document = t, this.platformId = i, this.renderPaneComponent = s, this.el = p, this.renderer2 = y, this.componentFactoryResolver = N, this.panelHandler = j, this.fb = L, this.cpm = q, this.cssHelper = G, this.paneStateService = l, this.paramEvaluatorService = g, this.renderer = P, this.settings = [], this.ancestory = [], this.panes = [], this.originPanes = [], this.yield = !!this.renderPaneComponent, this.afterContentInit$ = new D, this.resolvedContext$ = new O({}), this.schedulePluginChange = new D, this.ancestoryWithSelf = [], this.filteredListeners = [], this.css$ = new O({ css: this.cssHelper.makeJsonNode(), classes: {} }), this.cssSub = B([this.css$, this.afterContentInit$, this.schedulePluginChange]).pipe(d(([o]) => o), d(o => ({ css: this.cssHelper.reduceCss(o.css, `.pane-${this.indexPosition}`), classes: this.cssHelper.reduceSelector(o.classes, `.pane-${this.indexPosition}`) })), d(({ css: o, classes: c }) => [this.cssHelper.reduceCss(o, ".panel-page", !1), this.cssHelper.reduceCss(o, ".panel-page"), this.cssHelper.reduceSelector(c, ".panel-page", !1), this.cssHelper.reduceSelector(c, ".panel-page")]), h(([o, c, v, b]) => this.filteredCss = { css: c, classes: b }), d(([o, c, v, b]) => ({ css: o, classes: v })), d(({ css: o, classes: c }) => { let v = Object.keys(o.children).reduce((u, C) => M(M({}, u), C.indexOf(">") === 0 ? { [this.ancestoryWithSelf.map((x, R) => (R + 1) % 2 === 0 ? `.pane-${x}` : `.panel-${x}`).join(" ") + " " + C]: c[C] } : { [C]: c[C] }), {}), b = Object.keys(c).reduce((u, C) => M(M({}, u), C.indexOf(">") === 0 ? { [this.ancestoryWithSelf.map((x, R) => (R + 1) % 2 === 0 ? `.pane-${x}` : `.panel-${x}`).join(" ") + " " + C]: c[C] } : { [C]: c[C] }), {}); return { css: { children: v }, classes: b }; }), ne(500)).subscribe(({ css: o, classes: c }) => { console.log("reduced classes", c); let v = Object.keys(o.children).filter(u => u === "" || ge({ selector: u, document: this.document })), b = Object.keys(c).filter(u => u === "" || ge({ selector: u, document: this.document })); b.forEach((u, C) => { let x = u === "" ? [this.el.nativeElement] : u.indexOf(">") !== -1 ? this.document.querySelectorAll(u) : this.el.nativeElement.querySelectorAll(u), R = x.length; for (let _ = 0; _ < R; _++) {
        let H = c[b[C]], k = Object.keys(H), Pe = k.length;
        for (let z = 0; z < Pe; z++)
            x[_] && (H[k[z]] === Oe.REMOVE ? (console.log(`remove class ${k[z]}`), this.renderer2.removeClass(x[_], k[z])) : (console.log(`add class ${k[z]}`), this.renderer2.addClass(x[_], k[z])));
    } }), v.forEach(u => { console.log(`search: ${u}`); let C = u === "" ? [this.el.nativeElement] : u.indexOf(">") !== -1 ? this.document.querySelectorAll(u) : this.el.nativeElement.querySelectorAll(u), x = C.length, R = Object.keys(o.children[u].attributes); for (let _ = 0; _ < x; _++)
        C[_] && R.forEach(H => { console.log(`${u} { ${H}: ${o.children[u].attributes[H]}; }`); let k = st(H.replace("-", "_"), !1); this.renderer2.setStyle(C[_], k, o.children[u].attributes[H]); }); }); }), this.listeners$ = new O([]), this.listenersSub = B([this.listeners$, this.schedulePluginChange]).pipe(d(([o]) => o), h(o => { this.filteredListeners = o, console.log("pane listeners", o); })).subscribe(), this.wireListenersSub = B([this.listeners$, this.afterContentInit$]).pipe(ne(1), I(() => ie(this.filteredListeners.map(o => A({}).pipe(d(() => ({ paramNames: o.event.settings.paramsString ? o.event.settings.paramsString.split("&").filter(c => c.indexOf("=:") !== -1).map(c => c.split("=", 2)[1].substr(1)) : [] })), I(({ paramNames: c }) => this.paramEvaluatorService.paramValues(o.event.settings.params.reduce((v, b, u) => new Map([...v, [c[u], b]]), new Map)).pipe(d(v => Array.from(v).reduce((b, [u, C]) => Q(M({}, b), { [u]: C }), {})))), ue([]))))), h(o => { console.log("listener info", this.filteredListeners, o); let c = this.filteredListeners.length; for (let v = 0; v < c; v++) {
        let b = this.el.nativeElement.querySelectorAll(o[v].target);
        console.log("listener target", b), b.forEach(u => this.renderer.listen(u, o[v].type, C => { if (console.log("listener fired"), this.filteredListeners[v].handler.settings.params) {
            let x = this.filteredListeners[v].handler.settings.paramsString ? this.filteredListeners[v].handler.settings.paramsString.split("&").filter(R => R.indexOf("=:") !== -1).map(R => R.split("=", 2)[1].substr(1)) : [];
            this.paramEvaluatorService.paramValues(this.filteredListeners[v].handler.settings.params.reduce((R, _, H) => new Map([...R, [x[H], _]]), new Map)).pipe(d(R => Array.from(R).reduce((_, [H, k]) => Q(M({}, _), { [H]: k }), {}))).subscribe(R => { console.log("handler original event and params", C, R); });
        }
        else
            console.log("handler original event and params", C); }));
    } })).subscribe(), this.paneForm = this.fb.group({ contentPlugin: this.fb.control("", bt.required), name: this.fb.control(""), label: this.fb.control(""), settings: this.fb.control("") }), this.paneFormSub = this.paneForm.valueChanges.subscribe(o => { console.log(`pane form value plugin: ${this.pluginName}`), console.log(o); }), this.scheduleStateChange$ = new D, this.scheduleStateChangeSub = this.scheduleStateChange$.pipe(I(({ state: o }) => this.paneStateService.mergeState({ state: o, ancestory: [...this.ancestoryWithSelf], settings: this.settings, plugin: this.contentPlugin }))).subscribe(({ pageState: o }) => { this.panelPageStateService.upsert(o); }), this.onTouched = () => { }, this.pluginChangeSub = this.schedulePluginChange.pipe(T(() => this.pluginName && this.pluginName !== null && this.pluginName !== ""), I(() => this.cpm.getPlugin(this.pluginName))).subscribe(o => { this.contentPlugin = o, this.paneForm.get("contentPlugin").setValue(o.name), this.paneForm.get("name").setValue(this.name), this.paneForm.get("label").setValue(this.label), this.pluginName === "panel" ? this.resolveNestedPanelPage() : this.pluginName !== "yield" && this.renderPaneContent(); }), this.embedPanelSub = this.resolvedContext$.pipe(d(o => { o && o._root && !this.linkedPageId && this.settings.length === 0 && (this.embedPanel = new Ie(o._root)); })).subscribe(), this.panelPageStateService = f.getEntityCollectionService("PanelPageState"); }
    ngOnInit() { this.ancestoryWithSelf = [...this.ancestory ? this.ancestory : [], ...this.indexPosition !== void 0 && this.indexPosition !== null ? [this.indexPosition] : []], this.schedulePluginChange.next(void 0); }
    ngOnChanges(t) { if (t.ancestory || t.indexPosition) {
        let i = [...t.ancestory.currentValue ? t.ancestory.currentValue : this.ancestory ? this.ancestory : [], ...t.indexPosition.currentValue !== void 0 && t.indexPosition.currentValue !== null ? [t.indexPosition.currentValue] : this.indexPosition ? [this.indexPosition] : []];
        (i.length !== this.ancestoryWithSelf.length || this.ancestoryWithSelf.filter((s, p) => i[p] !== s).length !== 0) && (this.ancestoryWithSelf = i);
    } this.schedulePluginChange.next(void 0); }
    ngAfterContentInit() { this.afterContentInit$.next(void 0); }
    writeValue(t) { t && this.paneForm.setValue(t, { emitEvent: !1 }); }
    registerOnChange(t) { this.paneForm.valueChanges.subscribe(t); }
    registerOnTouched(t) { this.onTouched = t; }
    setDisabledState(t) { t ? this.paneForm.disable() : this.paneForm.enable(); }
    validate(t) { return this.paneForm.statusChanges.pipe(Ne(this.paneForm.status), T(i => i !== "PENDING"), Z(1), U(1), d(i => this.paneForm.valid ? null : { invalidForm: { invalidForm: { valid: !1, message: "pane is invalid" } } })); }
    resolveNestedPanelPage() { this.panelHandler.toObject(this.settings).subscribe(t => { this.panelPage = new Ie(Q(M({}, t), { contexts: this.contexts })); }); }
    renderPaneContent() { console.log("NG01203: render pane content"); let t = this.componentFactoryResolver.resolveComponentFactory(this.contentPlugin.renderComponent), i = this.contentPaneHost.viewContainerRef; i.clear(), this.componentRef = i.createComponent(t); let s = this.componentRef.instance; s.settings = this.settings, s.name = this.name, s.label = this.label, s.panes = this.panes, s.originPanes = this.originPanes, s.contexts = this.contexts ? this.contexts.map(p => new Me(p)) : [], s.displayType = this.displayType, s.resolvedContext = this.resolvedContext$.value, s.ancestory = this.ancestoryWithSelf, this.componentRef.instance.state && this.contentPlugin.handler && this.contentPlugin.handler.stateDefinition(this.settings).pipe(U(1)).subscribe(p => { this.componentRef.instance.state = p || {}; }), this.componentRef.instance.stateChange && this.componentRef.instance.stateChange.subscribe(p => { this.scheduleStateChange$.next({ state: p }); }); }
    static { this.\u0275fac = function (i) { return new (i || n)(e.\u0275\u0275directiveInject(et), e.\u0275\u0275directiveInject(Re), e.\u0275\u0275directiveInject(Ke, 12), e.\u0275\u0275directiveInject(e.ElementRef), e.\u0275\u0275directiveInject(e.Renderer2), e.\u0275\u0275directiveInject(e.ComponentFactoryResolver), e.\u0275\u0275directiveInject(F.PanelContentHandler), e.\u0275\u0275directiveInject(w.UntypedFormBuilder), e.\u0275\u0275directiveInject(Ae.ContentPluginManager), e.\u0275\u0275directiveInject(F.CssHelperService), e.\u0275\u0275directiveInject(F.PaneStateService), e.\u0275\u0275directiveInject(Le.ParamEvaluatorService), e.\u0275\u0275directiveInject(e.Renderer2), e.\u0275\u0275directiveInject(ee.EntityServices)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: n, selectors: [["classifieds-ui-render-pane"]], viewQuery: function (i, s) { if (i & 1 && (e.\u0275\u0275viewQuery(fe, 7), e.\u0275\u0275viewQuery(we, 5), e.\u0275\u0275viewQuery(J, 5)), i & 2) {
            let p;
            e.\u0275\u0275queryRefresh(p = e.\u0275\u0275loadQuery()) && (s.contentPaneHost = p.first), e.\u0275\u0275queryRefresh(p = e.\u0275\u0275loadQuery()) && (s.panelPageRouterComponent = p.first), e.\u0275\u0275queryRefresh(p = e.\u0275\u0275loadQuery()) && (s.panelPageComponent = p.first);
        } }, hostVars: 5, hostBindings: function (i, s) { i & 2 && (e.\u0275\u0275attribute("data-index", s.indexPosition), e.\u0275\u0275classMap(s.indexPositionClass), e.\u0275\u0275classProp("pane", !0)); }, inputs: { pluginName: "pluginName", settings: "settings", linkedPageId: "linkedPageId", contexts: "contexts", originPane: "originPane", displayType: "displayType", name: "name", label: "label", indexPosition: "indexPosition", ancestory: "ancestory", panes: "panes", originPanes: "originPanes", resolvedContext: "resolvedContext", css: "css", listeners: "listeners" }, standalone: !1, features: [e.\u0275\u0275ProvidersFeature([{ provide: ve, useExisting: X(() => n), multi: !0 }, { provide: Ee, useExisting: X(() => n), multi: !0 }, { provide: Ke, useExisting: X(() => n) }]), e.\u0275\u0275NgOnChangesFeature], decls: 7, vars: 5, consts: [[3, "formGroup"], ["classifiedsUiPaneContentHost", ""], ["formControlName", "settings", 3, "panelPage", "nested", "contexts", "css", "listeners", "ancestory", 4, "ngIf"], ["formControlName", "settings", 3, "id", "nested", "contexts", "ancestory", 4, "ngIf"], [4, "ngIf"], ["formControlName", "settings", 3, "panelPage", "nested", "contexts", "css", "listeners", "ancestory"], ["formControlName", "settings", 3, "id", "nested", "contexts", "ancestory"]], template: function (i, s) { i & 1 && (e.\u0275\u0275elementStart(0, "div", 0), e.\u0275\u0275elementContainerStart(1), e.\u0275\u0275template(2, kt, 0, 0, "ng-template", 1), e.\u0275\u0275elementContainerEnd(), e.\u0275\u0275template(3, qt, 1, 6, "classifieds-ui-panel-page", 2)(4, Bt, 1, 4, "classifieds-ui-panel-page", 3)(5, Ut, 1, 6, "classifieds-ui-panel-page", 2)(6, Gt, 1, 0, "classifieds-ui-panel-page-router", 4), e.\u0275\u0275elementEnd()), i & 2 && (e.\u0275\u0275property("formGroup", s.paneForm), e.\u0275\u0275advance(3), e.\u0275\u0275property("ngIf", s.pluginName == "panel" && !s.linkedPageId && s.settings.length !== 0), e.\u0275\u0275advance(), e.\u0275\u0275property("ngIf", s.pluginName == "panel" && s.linkedPageId), e.\u0275\u0275advance(), e.\u0275\u0275property("ngIf", s.pluginName == "panel" && !s.linkedPageId && s.settings.length === 0), e.\u0275\u0275advance(), e.\u0275\u0275property("ngIf", s.pluginName == "yield")); }, dependencies: () => [W.NgIf, w.NgControlStatus, w.NgControlStatusGroup, w.FormGroupDirective, w.FormControlName, fe, J, we], styles: ["[_nghost-%COMP%]{height:100%}"] }); }
} return n; })(), Fe = (() => { class n {
    static { this.COUNTER = 0; }
    set contextChanged(t) { }
    set contextsChanged(t) { t.map(i => this.schduleContextChange.next(i)); }
    set indexPosition(t) { this.indexPosition$.next(t); }
    set ancestory(t) { this.ancestory$.next(t); }
    set css(t) { this.css$.next(t); }
    set listeners(t) { this.listeners$.next(t); }
    get indexPositionClass() { return `panel-${this.indexPosition$.value}`; }
    get panesArray() { return this.panelForm.get("panes"); }
    constructor(t, i, s, p, y, N, j, L, q, G) { this.platformId = t, this.document = i, this.hostEl = s, this.renderer2 = p, this.componentFactoryResolver = y, this.fb = N, this.panelResolverService = j, this.spm = L, this.cssHelper = q, this.styleResolverService = G, this.nested = !1, this.heightChange = new tt, this.panelForm = this.fb.group({ name: this.fb.control(""), label: this.fb.control(""), panes: this.fb.array([]) }), this.panelFormSub = this.panelForm.valueChanges.subscribe(l => { console.log("paneL form value"), console.log(l); }), this.filteredListeners = [], this.afterContentInit$ = new D, this.schedulePanelRender = new D, this.rendered$ = new D, this.css$ = new O({ css: this.cssHelper.makeJsonNode(), classes: {} }), this.cssSub = B([this.css$, this.afterContentInit$, this.rendered$]).pipe(h(([l]) => console.log("css node", l.css)), d(([l]) => l), d(l => ({ css: this.cssHelper.reduceCss(l.css, `.panel-${this.indexPosition$.value}`), classes: this.cssHelper.reduceSelector(l.classes, `.panel-${this.indexPosition$.value}`) })), d(({ css: l, classes: g }) => [this.cssHelper.reduceCss(l, ".pane-", !1), l, this.cssHelper.reduceSelector(g, ".pane-", !1), g]), h(([l, g, P, f]) => this.filteredCss = { css: g, classes: f }), d(([l, g, P]) => ({ css: l, classes: P })), d(({ css: l, classes: g }) => { let P = Object.keys(l.children).reduce((o, c) => M(M({}, o), c.indexOf(">") === 0 ? { [this.ancestoryWithSelf$.value.map((v, b) => (b + 1) % 2 === 0 ? `.pane-${v}` : `.panel-${v}`).join(" ") + " " + c]: g[c] } : { [c]: g[c] }), {}), f = Object.keys(g).reduce((o, c) => M(M({}, o), c.indexOf(">") === 0 ? { [this.ancestoryWithSelf$.value.map((v, b) => (b + 1) % 2 === 0 ? `.pane-${v}` : `.panel-${v}`).join(" ") + " " + c]: g[c] } : { [c]: g[c] }), {}); return { css: { children: P }, classes: f }; }), ne(1)).subscribe(({ css: l, classes: g }) => { console.log("classes", g); let P = Object.keys(l.children).filter(o => o === "" || ge({ selector: o, document: this.document })), f = Object.keys(g).filter(o => o === "" || ge({ selector: o, document: this.document })); f.forEach((o, c) => { let v = o === "" ? [this.hostEl.nativeElement] : o.indexOf(">") !== -1 ? this.document.querySelectorAll(o) : this.hostEl.nativeElement.querySelectorAll(o), b = v.length; for (let u = 0; u < b; u++) {
        let C = g[f[c]], x = Object.keys(C), R = x.length;
        for (let _ = 0; _ < R; _++)
            v[u] && (C[x[_]] === Oe.REMOVE ? (console.log(`remove class ${x[_]}`), this.renderer2.removeClass(v[u], x[_])) : (console.log(`add class ${x[_]}`), this.renderer2.addClass(v[u], x[_])));
    } }), P.forEach(o => { console.log(`search: ${o}`); let c = o === "" ? [this.hostEl.nativeElement] : o.indexOf(">") !== -1 ? this.document.querySelectorAll(o) : this.hostEl.nativeElement.querySelectorAll(o), v = c.length, b = Object.keys(l.children[o].attributes); for (let u = 0; u < v; u++)
        c[u] && b.forEach(C => { console.log(`${o} { ${C}: ${l.children[o].attributes[C]}; }`); let x = st(C.replace("-", "_"), !1); this.renderer2.setStyle(c[u], x, l.children[o].attributes[C]); }); }); }), this.listeners$ = new O([]), this.listenersSub = this.listeners$.pipe(h(l => { console.log("panel listeners", l), this.filteredListeners = l; })).subscribe(), this.scheduleRender = new D, this.scheduleRenderSub = this.scheduleRender.pipe(h(() => console.log(`schdule renderer before [${this.panel.name}]`)), I(([l, g, P]) => this.panelResolverService.resolvePanes({ panes: l, contexts: g, resolvedContext: P }).pipe(d(({ resolvedPanes: f, originMappings: o }) => ({ resolvedPanes: f, originMappings: o, panes: l })))), I(({ panes: l, resolvedPanes: g, originMappings: P }) => this.styleResolverService.alterResolvedPanes({ panel: this.panel, resolvedPanes: g, originMappings: P }).pipe(d(({ resolvedPanes: f, originMappings: o }) => ({ panes: l, resolvedPanes: f, originMappings: o })))), h(() => console.log(`schdule renderer after [${this.panel.name}]`))).subscribe(({ panes: l, resolvedPanes: g, originMappings: P }) => { console.log(`render panel: ${this.panel.name}`), this.resolvedPanes = g, this.originPanes = l, this.originMappings = P, this.paneContainer && this.stylePlugin, this.populatePanesFormArray(), this.stylePlugin !== void 0 ? (console.log("render panel content [" + this.panel.name + "]"), this.renderPanelContent()) : this.rendered$.next(void 0); }), this.schduleContextChange = new D, this.schedulePanelRenderSub = this.schedulePanelRender.pipe(I(l => this.spm.getPlugin(l))).subscribe(l => { let g = this.componentFactoryResolver.resolveComponentFactory(l.renderComponent), P = this.panelHost.viewContainerRef; P.clear(); let f = P.createComponent(g); this.componentRef = f, f.instance.settings = this.panel.settings, f.instance.panes = this.resolvedPanes, f.instance.originPanes = this.panel.panes, f.instance.originMappings = this.originMappings, f.instance.contexts = this.contexts.map(o => new Me(o)), f.instance.displayType = this.displayType, f.instance.ancestory = this.ancestoryWithSelf$.value, f.instance.resolvedContext = this.resolvedContext, f.instance.panel = this.panel, f.instance.indexPosition = this.indexPosition$.value, f.instance.filteredListeners = this.filteredListeners, f.instance.filteredCss = this.filteredCss, this.rendered$.next(void 0); }), this.originMappings = [], this.resolvedContexts = [], this.ancestoryWithSelf$ = new O([]), this.ancestory$ = new O([]), this.indexPosition$ = new O(void 0), this.onTouched = () => { }, this.ancestorySub = B([this.ancestory$, this.indexPosition$]).pipe(h(([l, g]) => { this.ancestoryWithSelf$.next([...l, g]); })).subscribe(), this.counter = n.COUNTER++; }
    ngOnInit() { this.stylePlugin = this.panel.stylePlugin !== void 0 && this.panel.stylePlugin !== "" ? this.panel.stylePlugin : void 0, this.panel !== void 0 && this.panelHost !== void 0 && (console.log(`panel render init [${this.panel.name}]`, this.panel), this.panelResolverService.usedContexts(this.panel.panes).pipe(h(t => console.log(`used contexts filter before [${this.panel.name}]: ${t.join(",")}`)), d(t => t.filter(i => i !== "_page" && i !== "_root" && i !== "." && i.indexOf("panestate-" + this.ancestoryWithSelf$.value.join("-")) !== 0)), h(t => console.log(`used contexts filter after [${this.panel.name}]: ${t.join(",")}`)), I(t => this.schduleContextChange.pipe(h(i => console.log(`detected change [${this.panel.name}]: ${i}`)), d(i => [t, i]))), h(([t, i]) => console.log(`detected change [${this.panel.name}]: ${i} : ctx: ${t.join(",")}`)), T(([t, i]) => Array.isArray(t) && t.findIndex(s => s === i || s === `_${i}`) !== -1), Z(100)).subscribe(([t, i]) => { console.log(`Context changed [${this.panel.name}]: ${i}`), console.log(`contexts detected [${this.panel.name}]: ${t.join(",")}`), this.scheduleRender.next([this.panel.panes, this.contexts, this.resolvedContext]); })); }
    ngOnChanges(t) { this.stylePlugin = this.panel.stylePlugin !== void 0 && this.panel.stylePlugin !== "" ? this.panel.stylePlugin : void 0, t.resolvedContext && t.resolvedContext.previousValue === void 0 && this.scheduleRender.next([this.panel.panes, this.contexts, this.resolvedContext]); }
    ngAfterViewInit() { }
    ngAfterContentInit() { this.afterContentInit$.next(void 0); }
    writeValue(t) { t && this.panelForm.setValue(t, { emitEvent: !1 }); }
    registerOnChange(t) { this.panelForm.valueChanges.subscribe(t); }
    registerOnTouched(t) { this.onTouched = t; }
    setDisabledState(t) { t ? this.panelForm.disable() : this.panelForm.enable(); }
    validate(t) { return this.panelForm.statusChanges.pipe(Ne(this.panelForm.status), T(i => i !== "PENDING"), Z(1), U(1), d(i => this.panelForm.valid ? null : { invalidForm: { valid: !1, message: "panel are invalid" } })); }
    populatePanesFormArray() { this.panesArray.clear(), this.resolvedPanes.forEach((t, i) => { this.panesArray.push(this.fb.control("")); }); }
    renderPanelContent() { this.schedulePanelRender.next(this.stylePlugin); }
    static { this.\u0275fac = function (i) { return new (i || n)(e.\u0275\u0275directiveInject(Re), e.\u0275\u0275directiveInject(et), e.\u0275\u0275directiveInject(e.ElementRef), e.\u0275\u0275directiveInject(e.Renderer2), e.\u0275\u0275directiveInject(e.ComponentFactoryResolver), e.\u0275\u0275directiveInject(w.UntypedFormBuilder), e.\u0275\u0275directiveInject(F.PanelResolverService), e.\u0275\u0275directiveInject(F.StylePluginManager), e.\u0275\u0275directiveInject(F.CssHelperService), e.\u0275\u0275directiveInject(F.StyleResolverService)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: n, selectors: [["classifieds-ui-render-panel"]], viewQuery: function (i, s) { if (i & 1 && (e.\u0275\u0275viewQuery(fe, 7), e.\u0275\u0275viewQuery(Qt, 7), e.\u0275\u0275viewQuery(me, 5)), i & 2) {
            let p;
            e.\u0275\u0275queryRefresh(p = e.\u0275\u0275loadQuery()) && (s.panelHost = p.first), e.\u0275\u0275queryRefresh(p = e.\u0275\u0275loadQuery()) && (s.paneContainer = p.first), e.\u0275\u0275queryRefresh(p = e.\u0275\u0275loadQuery()) && (s.renderedPanes = p);
        } }, hostVars: 5, hostBindings: function (i, s) { i & 2 && (e.\u0275\u0275attribute("data-index", s.indexPosition$.value), e.\u0275\u0275classMap(s.indexPositionClass), e.\u0275\u0275classProp("panel", !0)); }, inputs: { panel: "panel", contexts: "contexts", nested: "nested", displayType: "displayType", resolvedContext: "resolvedContext", contextChanged: "contextChanged", contextsChanged: "contextsChanged", indexPosition: "indexPosition", ancestory: "ancestory", css: "css", listeners: "listeners" }, outputs: { heightChange: "heightChange" }, standalone: !1, features: [e.\u0275\u0275ProvidersFeature([{ provide: ve, useExisting: X(() => n), multi: !0 }, { provide: Ee, useExisting: X(() => n), multi: !0 }]), e.\u0275\u0275NgOnChangesFeature], decls: 5, vars: 2, consts: [["panes", ""], [1, "render-panel", 3, "formGroup"], ["classifiedsUiPaneContentHost", ""], [4, "ngIf"], [3, "ngSwitch"], [4, "ngSwitchCase"], ["formArrayName", "panes"], [3, "formControlName", "pluginName", "settings", "name", "label", "originPane", "contexts", "displayType", "resolvedContext", "indexPosition", "css", "listeners", "ancestory", "panes", "originPanes", 4, "ngFor", "ngForOf"], [3, "formControlName", "pluginName", "settings", "name", "label", "originPane", "contexts", "displayType", "resolvedContext", "indexPosition", "css", "listeners", "ancestory", "panes", "originPanes"], [3, "pluginName", "settings", "name", "label", "originPane", "contexts", "linkedPageId", "displayType", "resolvedContext", "indexPosition", "css", "listeners", "ancestory", "panes", "originPanes", 4, "ngFor", "ngForOf"], [3, "pluginName", "settings", "name", "label", "originPane", "contexts", "linkedPageId", "displayType", "resolvedContext", "indexPosition", "css", "listeners", "ancestory", "panes", "originPanes"]], template: function (i, s) { i & 1 && (e.\u0275\u0275elementStart(0, "div", 1, 0), e.\u0275\u0275elementContainerStart(2), e.\u0275\u0275template(3, Wt, 0, 0, "ng-template", 2), e.\u0275\u0275elementContainerEnd(), e.\u0275\u0275template(4, Zt, 4, 3, "ng-container", 3), e.\u0275\u0275elementEnd()), i & 2 && (e.\u0275\u0275property("formGroup", s.panelForm), e.\u0275\u0275advance(4), e.\u0275\u0275property("ngIf", !s.stylePlugin && s.resolvedPanes)); }, dependencies: [W.NgForOf, W.NgIf, W.NgSwitch, W.NgSwitchCase, w.NgControlStatus, w.NgControlStatusGroup, w.FormGroupDirective, w.FormControlName, w.FormArrayName, fe, me], styles: ["[_nghost-%COMP%]{height:100%}.render-panel[_ngcontent-%COMP%]{height:100%}"] }); }
} return n; })(), J = class n {
    static { this.registredContextListeners = new Set; }
    set id(a) { this.id$.next(a); }
    set panelPage(a) { this.panelPage$.next(a); }
    set nested(a) { this.nested$.next(a); }
    set contexts(a) { this.contexts$.next(a); }
    set ancestory(a) { this.ancestory$.next(a); }
    set css(a) { this.css$.next(a); }
    set listeners(a) { this.listeners$.next(a); }
    get panelsArray() { return this.pageForm.get("panels"); }
    get panelpageAttr() { return this?.panelPageCached?.path?.toLowerCase().replace(/\//g, "__"); }
    constructor(a, t, i, s, p, y, N, j, L, q, G, l, g, P, f, o, c, v, b, u, C, x, R, _, H, k, Pe, z, ht, ut, be) {
        this.platformId = a, this.mediaSettings = t, this.routerStore = i, this.fb = s, this.el = p, this.inlineContextResolver = y, this.pageBuilderFacade = N, this.cpm = j, this.cxm = L, this.lpm = q, this.componentFactoryResolver = G, this.styleLoader = l, this.http = g, this.cssHelper = P, this.attributeSerializer = f, this.formService = o, this.panelsContextService = c, this.asyncApiCallHelperSvc = v, this.crudDataHelperService = b, this.entityDefinitionService = u, this.ngZone = C, this.persistService = x, this.stylizerService = R, this.classifyService = _, this.fileService = H, this.authFacade = k, this.paramEvaluatorService = Pe, this.renderer = z, this.iepm = ht, this.ihpm = ut, this.injector = Ct(Pt), this.closePreview = new tt, this.previewing = !1, this.contextsChanged = [], this.persistenceEnabled = !1, this.onInit$ = new D, this.afterViewInit$ = new D, this.afterContentInit$ = new D, this.renderLayout$ = new D, this.id$ = new O(void 0), this.panelPage$ = new O(void 0), this.nested$ = new O(!1), this.ancestory$ = new O([]), this.contexts$ = new O([]), this.instanceUniqueIdentity = ce(), this.isStable = !1, this.managedCssCache = "", this.managedClassesCache = {}, this.filteredListeners = [], this.css$ = new O({ css: this.cssHelper.makeJsonNode(), classes: {} }), this.cssSub = this.css$.subscribe(r => { this.nested$.value && console.log("filtered css nested", r), this.filteredCss = r; }), this.listeners$ = new O([]), this.listenersSub = this.listeners$.pipe(h(r => { this.filteredListeners = r; })).subscribe(), this.settingsFormArray = this.fb.array([]), this.pageForm = this.fb.group({ panels: this.fb.array([]) }), this.bridgeSub = this.pageForm.valueChanges.pipe(T(() => this.nested$.value), Z(500)).subscribe(r => { console.log("write page"), console.log(r), this.settingsFormArray.clear(); let m = this.attributeSerializer.convertToGroup(this.attributeSerializer.serialize(r, "value").attributes[0]); this.settingsFormArray.push(m), console.log(m.value); }), this.idOrPanelPageSub = B([this.id$, this.panelPage$]).pipe(jt(), d(([r, m]) => ({ id: r, panelPage: m })), T(({ id: r, panelPage: m }) => !!r || !!m), I(({ id: r, panelPage: m }) => Se(() => !r, A({ panelPage: m }), new ke($ => { let E = this.entityDefinitionService.getDefinition("PanelPage").metadata; return this.crudDataHelperService.evaluateCollectionPlugins({ query: `identity=${r}`, plugins: E.crud, op: "query" }).pipe(d(S => S && S.length !== 0 ? S[0] : void 0), h(S => { $.next({ panelPage: S }), $.complete(); })).subscribe(); }))), I(({ panelPage: r }) => this.cpm.getPlugins(r.panels.reduce((m, $) => ($.panes.forEach(E => { m.includes(E.contentPlugin) || m.push(E.contentPlugin); }), m), [])).pipe(d(() => ({ panelPage: r })))), I(({ panelPage: r }) => Se(() => !this.nested$.value, this.panelsContextService.allActivePageContexts({ panelPage: r }).pipe(d(m => ({ panelPage: r, contexts: Array.from(m) }))), A({ panelPage: r, contexts: [] }))), h(({ panelPage: r, contexts: m }) => { this.hookupFormChange({ panelPage: r }), this.populatePanelsFormArray({ panelPage: r }), this.panelPageCached = r, this.persistenceEnabled = r.persistence && r.persistence.dataduct && r.persistence.dataduct.plugin && r.persistence.dataduct.plugin !== "", this.filteredListeners = r.interactions && r.interactions.interactions && r.interactions.interactions.listeners ? r.interactions.interactions.listeners : [], this.renderLayout$.next(r), this.contexts$.next([...r.contexts ? r.contexts.map($ => new Me($)) : [], ...m]), this.hookupCss({ file: r.cssFile ? r.cssFile.trim() : void 0 }), console.log(`cached panel page: ${r.id}`); })).subscribe(), this.hookupContextSub = B(this.contexts$, this.afterContentInit$).pipe(d(([r]) => r), I(r => this.inlineContextResolver.resolveMerged(r, `panelpage:${ce()}`).pipe(I(m => this.cxm.getPlugins().pipe(d($ => ({ contexts: r, resolvedContext: m, globalPlugins: Array.from($.values()).filter(E => E.global === !0) })))), U(1))), h(() => { this.resolveSub && this.resolveSub.unsubscribe(); }), h(({ contexts: r, resolvedContext: m, globalPlugins: $ }) => { this.resolvedContext = m; let E = new D; if (Be(this.platformId)) {
            let S = setInterval(() => { n.registredContextListeners.size === 0 && (E.next(), E.complete(), clearInterval(S)); }, 1e3);
        } this.resolveSub = this.inlineContextResolver.resolveMergedSingle(r).pipe(_e($.length + (r ? r.length : 0)), h(() => n.registredContextListeners.add(this.instanceUniqueIdentity)), h(S => console.log("buffer", S)), Mt(1), h(S => { S.length === 0 && n.registredContextListeners.delete(this.instanceUniqueIdentity); }), T(S => S.length !== 0), h(S => { this.contextsChanged = S.reduce((V, [te, ae]) => [...V, ...V.includes(te) ? [] : [te]], []), this.resolvedContext = S.reduce((V, [te, ae]) => Q(M({}, V), { [te]: ae }), this.resolvedContext); }), h(() => n.registredContextListeners.delete(this.instanceUniqueIdentity)), Be(this.platformId) ? Nt(E) : h(() => { })).subscribe(); })).subscribe(), this.renderLayoutSub = B([this.renderLayout$, this.afterViewInit$]).pipe(ne(1), d(([r]) => ({ panelPage: r })), I(({ panelPage: r }) => this.lpm.getPlugin(r.layoutType).pipe(d(m => ({ panelPage: r, plugin: m })))), h(() => console.log("start render layout")), d(({ plugin: r, panelPage: m }) => ({ panelPage: m, plugin: r, viewContainerRef: this.layoutRendererHost.viewContainerRef })), h(({ viewContainerRef: r }) => r.clear()), d(({ plugin: r, viewContainerRef: m, panelPage: $ }) => ({ panelPage: $, layoutRendererRef: m.createComponent(r.renderer) })), h(({ layoutRendererRef: r }) => this.layoutRendererRef = r), h(({ layoutRendererRef: r, panelPage: m }) => { r.instance.renderPanelTpl = this.renderPanelTpl, r.instance.panelPage = m; }), h(() => console.log("end render layout"))).subscribe(), this.stylizerSub = this.afterViewInit$.pipe(T(() => de(this.platformId)), h(() => { this.stylizerService.stylize({ targetNode: this.el.nativeElement }); })).subscribe(), this.classifySub = this.afterViewInit$.pipe(T(() => de(this.platformId)), h(() => { this.classifyService.classify({ targetNode: this.el.nativeElement }); })).subscribe(), this.stylizerMutatedSub = de(this.platformId) ? this.stylizerService.mutated$.pipe(Z(2e3), _e(1), I(({ stylesheet: r }) => this.authFacade.getUser$.pipe(d(m => ({ stylesheet: r, isAuthenticated: !!m })))), T(({ isAuthenticated: r }) => r), h(({ stylesheet: r }) => { console.log("merged css", r); }), T(() => !!this.panelPageCached && !!this.panelPageCached.id), I(({ stylesheet: r }) => this.isStable ? A({ stylesheet: r }) : this.ngZone.onStable.asObservable().pipe(d(() => ({ stylesheet: r })), U(1))), d(({ stylesheet: r }) => ({ stylesheet: (this.managedCssCache && this.managedCssCache.trim() !== "" ? this.managedCssCache + `
` : "") + r })), We(({ stylesheet: r }) => this.fileService.bulkUpload({ nocache: !0, files: [new File([r], `panelpage__${this.panelPageCached.id}.css`)], fileNameOverride: `panelpage__${this.panelPageCached.id}.css` })), h(() => { console.log("stylesheet saved."); })).subscribe() : void 0, this.classifyMutatedSub = de(this.platformId) ? this.classifyService.mutated$.pipe(Z(2e3), _e(1), I(({ classes: r }) => this.authFacade.getUser$.pipe(d(m => ({ classes: r, isAuthenticated: !!m })))), T(({ isAuthenticated: r }) => r), h(({ classes: r }) => { console.log("merged classes", r); }), T(() => !!this.panelPageCached && !!this.panelPageCached.id), I(({ classes: r }) => this.isStable ? A({ classes: r }) : this.ngZone.onStable.asObservable().pipe(d(() => ({ classes: r })), U(1))), d(({ classes: r }) => ({ classes: Array.from(r.keys()).reduce((m, $) => Q(M({}, m), { [$]: Array.from(r.get($).keys()).filter(E => r.get($).get(E) !== Oe.KEEP).reduce((E, S) => Q(M({}, E), { [S]: r.get($).get(S) }), {}) }), {}) })), d(({ classes: r }) => ({ classes: $e(this.managedClassesCache, r) })), d(({ classes: r }) => ({ json: JSON.stringify(r) })), We(({ json: r }) => this.fileService.bulkUpload({ nocache: !0, files: [new File([r], `panelpage__${this.panelPageCached.id}__classes.json`)], fileNameOverride: `panelpage__${this.panelPageCached.id}__classes.json` })), h(() => { console.log("classes saved."); })).subscribe() : void 0, this.onStableSub = this.ngZone.onStable.asObservable().pipe(h(() => this.isStable = !0)).subscribe(), this.onUnstableSub = this.ngZone.onUnstable.asObservable().pipe(h(() => this.isStable = !1)).subscribe(), this.wireListenersSub = B([this.listeners$, this.renderLayout$, this.afterContentInit$]).pipe(ne(1), T(() => !!this.id$.value || !!this.panelPageCached?.id), I(() => ie(this.filteredListeners.map(r => this.paramEvaluatorService.paramValues((r.event.settings.params || []).reduce((m, $, E) => { let S = r.event.settings.paramsString?.split("&").filter(V => V.includes("=:")).map(V => V.split("=", 2)[1].substring(1))[E]; return new Map([...m, [S, $]]); }, new Map)).pipe(d(m => Array.from(m).reduce(($, [E, S]) => Q(M({}, $), { [E]: S }), {})), ue({}))))), I(r => this.iepm.getPlugins().pipe(d(m => ({ allPlugins: m, listenerParams: r })))), h(({ allPlugins: r, listenerParams: m }) => { let $ = this.id$.value || this.panelPageCached.id; for (let E of r.values()) {
            let S = E.id, V = this.filteredListeners.map((Y, le) => ({ idx: le, listener: Y })).filter(Y => Y.listener.event.plugin === S);
            if (V.length === 0)
                continue;
            let te = V.map(Y => Y.listener), ae = V.map(Y => m[Y.idx]);
            E.connect({ filteredListeners: te, listenerParams: ae, renderer: this.renderer, panelPageId: $, callback: Wi => Ve(this, [Wi], function* ({ handlerParams: Y, plugin: le, index: gt, evt: ft }) { let xe = V[gt].idx, mt = yield Rt(this.paramEvaluatorService, this.filteredListeners[xe], Y); this.ihpm.getPlugin(le).pipe(h(vt => vt.handle({ handlerParams: mt, plugin: le, index: xe, listener: this.filteredListeners[xe], evt: ft, renderer: this.renderer, panelPageComponent: this }))).subscribe(); }) }).subscribe();
        } })).subscribe(), this.onTouched = () => { }, this.panelPageService = be.getEntityCollectionService("PanelPage"), this.panelPageFormService = be.getEntityCollectionService("PanelPageForm"), this.panelPageStateService = be.getEntityCollectionService("PanelPageState");
    }
    ngOnInit() { this.onInit$.next(void 0); }
    ngAfterViewInit() { this.afterViewInit$.next(void 0); }
    ngAfterContentInit() { this.afterContentInit$.next(void 0); }
    ngOnDestroy() { n.registredContextListeners.delete(this.instanceUniqueIdentity); }
    populatePanelsFormArray({ panelPage: a }) { this.panelsArray.clear(), a.panels.forEach(() => { this.panelsArray.push(this.fb.control("")); }); }
    hookupFormChange({ panelPage: a }) { B([this.pageForm.valueChanges, this.pageForm.statusChanges]).pipe(Z(100), T(([t, i]) => a !== void 0 && a.displayType === "form" && i !== "PENDING")).subscribe(([t]) => { let i = this.pageForm.valid, s = this.panelPageCached.persistence ? this.panelPageCached.persistence : void 0, p = new Ge(Q(M({}, t), { name: a.name, title: a.title, derivativeId: a.id, persistence: s, valid: i })); this.pageBuilderFacade.setForm(a.name, p); }); }
    hookupCss({ file: a }) { ie([A(void 0), A(void 0), A(void 0), this.panelPageCached.id ? this.http.get(`${this.mediaSettings.imageUrl}/media/panelpage__${this.panelPageCached.id}__classes.json`).pipe(Tt(() => A(void 0)), ue(void 0)) : A(void 0)]).pipe(h(([t, i, s, p]) => { console.log("fetched managed panelpage css and class files"); let y = {}; this.managedCssCache = "", this.managedClassesCache = p, t && (y = $e(y, t)), i && (this.managedCssCache = s, y = $e(y, i)), this.filteredCss = { css: y, classes: p }; })).subscribe(); }
    submit() { if (this.pageForm.valid) {
        let a = new Ge(M({}, this.pageForm.value)), t = this.formService.serializeForm(a);
        console.log(a), console.log(this.formService.serializeForm(a)), console.log("form data", t), this.persistService.persist({ data: t, persistence: this.panelPageCached.persistence }).subscribe(() => { console.log("persisted data"); });
    }
    else
        console.log("detected form invalid"); }
    onPreviewClose() { this.closePreview.emit(); }
    writeValue(a) { a && this.settingsFormArray.setValue(a, { emitEvent: !1 }); }
    registerOnChange(a) { this.settingsFormArray.valueChanges.subscribe(a); }
    registerOnTouched(a) { this.onTouched = a; }
    setDisabledState(a) { a ? this.settingsFormArray.disable() : this.settingsFormArray.enable(); }
    validate(a) { return this.pageForm.statusChanges.pipe(Ne(this.pageForm.status), T(t => t !== "PENDING"), Z(1), U(1), d(t => this.pageForm.valid ? null : { invalidForm: { valid: !1, message: "content is invalid" } })); }
    static { this.\u0275fac = function (t) { return new (t || n)(e.\u0275\u0275directiveInject(Re), e.\u0275\u0275directiveInject(Ft), e.\u0275\u0275directiveInject(Te.Store), e.\u0275\u0275directiveInject(w.UntypedFormBuilder), e.\u0275\u0275directiveInject(e.ElementRef), e.\u0275\u0275directiveInject(oe.InlineContextResolverService), e.\u0275\u0275directiveInject(F.PageBuilderFacade), e.\u0275\u0275directiveInject(Ae.ContentPluginManager), e.\u0275\u0275directiveInject(oe.ContextPluginManager), e.\u0275\u0275directiveInject(it.LayoutPluginManager), e.\u0275\u0275directiveInject(e.ComponentFactoryResolver), e.\u0275\u0275directiveInject(se.StyleLoaderService), e.\u0275\u0275directiveInject(at.HttpClient), e.\u0275\u0275directiveInject(F.CssHelperService), e.\u0275\u0275directiveInject(lt.AttributeSerializerService), e.\u0275\u0275directiveInject(F.FormService), e.\u0275\u0275directiveInject(F.PanelsContextService), e.\u0275\u0275directiveInject(se.AsyncApiCallHelperService), e.\u0275\u0275directiveInject(De.CrudDataHelperService), e.\u0275\u0275directiveInject(ee.EntityDefinitionService), e.\u0275\u0275directiveInject(e.NgZone), e.\u0275\u0275directiveInject(He.PersistService), e.\u0275\u0275directiveInject(ye.StylizerService), e.\u0275\u0275directiveInject(ye.ClassifyService), e.\u0275\u0275directiveInject(nt.FilesService), e.\u0275\u0275directiveInject(ct.AuthFacade), e.\u0275\u0275directiveInject(Le.ParamEvaluatorService), e.\u0275\u0275directiveInject(e.Renderer2), e.\u0275\u0275directiveInject(re.InteractionEventPluginManager), e.\u0275\u0275directiveInject(re.InteractionHandlerPluginManager), e.\u0275\u0275directiveInject(ee.EntityServices)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: n, selectors: [["classifieds-ui-panel-page"]], viewQuery: function (t, i) { if (t & 1 && (e.\u0275\u0275viewQuery($t, 5), e.\u0275\u0275viewQuery(Jt, 7), e.\u0275\u0275viewQuery(Xe, 5), e.\u0275\u0275viewQuery(Fe, 5)), t & 2) {
            let s;
            e.\u0275\u0275queryRefresh(s = e.\u0275\u0275loadQuery()) && (i.gridLayout = s.first), e.\u0275\u0275queryRefresh(s = e.\u0275\u0275loadQuery()) && (i.renderPanelTpl = s.first), e.\u0275\u0275queryRefresh(s = e.\u0275\u0275loadQuery()) && (i.layoutRendererHost = s.first), e.\u0275\u0275queryRefresh(s = e.\u0275\u0275loadQuery()) && (i.renderedPanels = s);
        } }, hostVars: 3, hostBindings: function (t, i) { t & 2 && (e.\u0275\u0275attribute("data-panelpage", i.panelpageAttr), e.\u0275\u0275classProp("panel-page", !0)); }, inputs: { id: "id", panelPage: "panelPage", nested: "nested", contexts: "contexts", ancestory: "ancestory", css: "css", listeners: "listeners", resolvedContext: "resolvedContext", previewing: "previewing" }, outputs: { closePreview: "closePreview" }, standalone: !1, features: [e.\u0275\u0275ProvidersFeature([{ provide: ve, useExisting: X(() => n), multi: !0 }, { provide: Ee, useExisting: X(() => n), multi: !0 }])], decls: 6, vars: 2, consts: [["renderPanelTpl", ""], ["mat-icon-button", "", "class", "close-preview", 3, "click", 4, "ngIf"], [3, "formGroup"], ["classifiedsUiLayoutRendererHost", ""], ["mat-icon-button", "", 1, "close-preview", 3, "click"], ["formArrayName", "panels"], [3, "formControlName", "panel", "nested", "contexts", "resolvedContext", "contextsChanged", "displayType", "indexPosition", "css", "listeners", "ancestory"]], template: function (t, i) { t & 1 && (e.\u0275\u0275template(0, ei, 3, 1, "button", 1), e.\u0275\u0275elementStart(1, "div", 2), e.\u0275\u0275elementContainerStart(2), e.\u0275\u0275template(3, ti, 0, 0, "ng-template", 3), e.\u0275\u0275elementContainerEnd(), e.\u0275\u0275elementEnd(), e.\u0275\u0275template(4, ii, 3, 12, "ng-template", null, 0, e.\u0275\u0275templateRefExtractor)), t & 2 && (e.\u0275\u0275property("ngIf", i.previewing), e.\u0275\u0275advance(), e.\u0275\u0275property("formGroup", i.pageForm)); }, dependencies: [W.NgIf, w.NgControlStatus, w.NgControlStatusGroup, w.FormGroupDirective, w.FormControlName, w.FormArrayName, Ce.MatIconButton, dt.MatIcon, Fe, Xe], styles: ["[_nghost-%COMP%]     gridster{background-color:#fff}[_nghost-%COMP%]     gridster-item{background-color:#fff}"] }); }
}, Bi = (() => { class n {
    static { this.\u0275fac = function (i) { return new (i || n); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: n, selectors: [["classifieds-ui-empty-layout"]], standalone: !1, decls: 1, vars: 0, template: function (i, s) { i & 1 && e.\u0275\u0275text(0, "empty layout content"); }, encapsulation: 2 }); }
} return n; })(), ni = (() => { class n {
    constructor(t, i) { this.dialog = i, this.panelPageId = t.panelPageId || ""; }
    onClose() { this.dialog.closeAll(); }
    static { this.\u0275fac = function (i) { return new (i || n)(e.\u0275\u0275directiveInject(Lt), e.\u0275\u0275directiveInject(K.MatDialog)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: n, selectors: [["quell-render-dialog"]], standalone: !1, decls: 7, vars: 1, consts: [["mat-dialog-title", ""], [3, "id"], ["mat-button", "", 3, "click"]], template: function (i, s) { i & 1 && (e.\u0275\u0275elementStart(0, "h2", 0), e.\u0275\u0275text(1, "Panel Page"), e.\u0275\u0275elementEnd(), e.\u0275\u0275elementStart(2, "mat-dialog-content"), e.\u0275\u0275element(3, "classifieds-ui-panel-page", 1), e.\u0275\u0275elementEnd(), e.\u0275\u0275elementStart(4, "mat-dialog-actions")(5, "button", 2), e.\u0275\u0275listener("click", function () { return s.onClose(); }), e.\u0275\u0275text(6, "Close"), e.\u0275\u0275elementEnd()()), i & 2 && (e.\u0275\u0275advance(3), e.\u0275\u0275property("id", s.panelPageId)); }, dependencies: [Ce.MatButton, K.MatDialogTitle, K.MatDialogActions, K.MatDialogContent, J], encapsulation: 2 }); }
} return n; })(), si = (() => { class n {
    get panelPageId() { return this.data?.panelPageId ?? ""; }
    constructor(t) { this.host = t; }
    close() { let t = this.host.nativeElement.closest(".cdk-overlay-pane"); t && t.remove(); }
    static { this.\u0275fac = function (i) { return new (i || n)(e.\u0275\u0275directiveInject(e.ElementRef)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: n, selectors: [["quell-popover-overlay"]], standalone: !1, decls: 4, vars: 1, consts: [[1, "popover-container"], [1, "close-button", 3, "click"], [3, "id"]], template: function (i, s) { i & 1 && (e.\u0275\u0275elementStart(0, "div", 0)(1, "button", 1), e.\u0275\u0275listener("click", function () { return s.close(); }), e.\u0275\u0275text(2, "\u2715"), e.\u0275\u0275elementEnd(), e.\u0275\u0275element(3, "classifieds-ui-panel-page", 2), e.\u0275\u0275elementEnd()), i & 2 && (e.\u0275\u0275advance(3), e.\u0275\u0275property("id", s.panelPageId)); }, dependencies: [J], styles: [".popover-container[_ngcontent-%COMP%]{position:relative;padding:12px;background:#fff;border-radius:8px;box-shadow:0 4px 12px #00000026;min-width:200px;max-width:90vw;max-height:80vh;overflow:auto}.close-button[_ngcontent-%COMP%]{position:absolute;top:4px;right:6px;border:none;background:transparent;cursor:pointer;font-size:16px;opacity:.6}.close-button[_ngcontent-%COMP%]:hover{opacity:1}"] }); }
} return n; })(), pe = new Map, he = new Map, ri = ({ pageBuilderFacade: n, formService: a, persistService: t, transversePanelpageComponentSvc: i }) => new je({ id: "panels_form_submit", title: "Submit Panels Form", handle: ({ handlerParams: s, panelPageComponent: p }) => { let y = s?.name; if (!y) {
        console.log("No form name provided. Ignoring submission request.");
        return;
    } if (he.get(y)) {
        console.log(`Form submission is already being processed for: ${y}`);
        return;
    } if (pe.get(y)) {
        console.log(`Form submission for ${y} is throttled. Try again later.`);
        return;
    } he.set(y, !0), console.log(`Processing form submission for: ${y}`), n.getForm$(y).pipe(U(1), h(N => { if (!N) {
        console.log(`Form ${y} not found.`);
        return;
    } if (N.valid) {
        let j = a.serializeForm(N);
        console.log("Panel Page Form Data:", j), t.persist({ data: j, persistence: N.persistence }).subscribe({ next: () => { console.log("Form Submitted successfully:", y), alert("Form Submitted"); }, error: L => { console.error("Error persisting form: ", L); }, complete: () => { console.log("Form submission complete for:", y); } });
    }
    else
        i.traverseAndVisit(p, j => { j instanceof me && j.componentRef && j.componentRef.instance && j.componentRef.instance.markAsTouched && j.componentRef.instance.markAsTouched(); }), console.log("Form is invalid or unavailable. Skipping processing for:", y); }), Ot(() => { he.delete(y), pe.set(y, !0), qe(2e3).subscribe(() => { pe.delete(y); }), console.log(`Throttle applied for form: ${y}`); })).subscribe({ error: N => { console.error(`Error occurred during form submission for ${y}:`, N), he.delete(y), pe.delete(y); } }); } }), oi = ({ dialog: n }) => new je({ id: "panels_dialog", title: "Open Panels Dialog", handle: ({ handlerParams: a }) => { let t = a?.panelPageId || "", i = a?.title || "Panel Page", s = a?.width || "800px"; if (!t) {
        console.error("No Panel Page ID provided. Cannot open dialog.");
        return;
    } n.open(ni, { width: s, data: { panelPageId: t, title: i } }); } }), ai = ({ overlay: n, injector: a }) => new je({ id: "anchored_dialog", title: "Open Anchored Dialog", handle: ({ handlerParams: t, evt: i }) => { let s = t?.panelPageId || "", p = t?.width || "300px", y = t?.height || "", N = parseInt(t?.offsetX || "0", 10), j = parseInt(t?.offsetY || "0", 10), L = t?.position || "bottom_start"; if (!s) {
        console.error("No Panel Page ID provided. Cannot open anchored dialog.");
        return;
    } let q = i?.target; if (!q) {
        console.error("No anchor element found for anchored dialog.");
        return;
    } let G = { bottom_start: { originX: "start", originY: "bottom", overlayX: "start", overlayY: "top" }, bottom_end: { originX: "end", originY: "bottom", overlayX: "end", overlayY: "top" }, top_start: { originX: "start", originY: "top", overlayX: "start", overlayY: "bottom" }, top_end: { originX: "end", originY: "top", overlayX: "end", overlayY: "bottom" }, right: { originX: "end", originY: "center", overlayX: "start", overlayY: "center" }, left: { originX: "start", originY: "center", overlayX: "end", overlayY: "center" } }, l = G[L] || G.bottom_start, g = n.position().flexibleConnectedTo(q).withPositions([l]).withDefaultOffsetX(N).withDefaultOffsetY(j).withFlexibleDimensions(!0).withPush(!0), P = n.create({ width: p, height: y, positionStrategy: g, hasBackdrop: !0, backdropClass: "cdk-overlay-transparent-backdrop", panelClass: "anchored-dialog-panel" }), f = new Ht(si, null, a), o = P.attach(f); o.instance.data = { panelPageId: s, anchorElement: q }, P.backdropClick().subscribe(() => P.dispose()); } }), li = (() => { class n extends Dt {
    shouldReuseRoute(t, i) { return !0; }
    static { this.\u0275fac = (() => { let t; return function (s) { return (t || (t = e.\u0275\u0275getInheritedFactory(n)))(s || n); }; })(); }
    static { this.\u0275prov = e.\u0275\u0275defineInjectable({ token: n, factory: n.\u0275fac }); }
} return n; })(), ci = (() => { class n {
    traverseAndVisit(t, i) { t && (i(t), t instanceof J ? t.renderedPanels.forEach(s => { this.traverseAndVisit(s, i); }) : t instanceof Fe ? t.renderedPanes.forEach(s => { this.traverseAndVisit(s, i); }) : t instanceof me && t.panelPageComponent && this.traverseAndVisit(t.panelPageComponent, i)); }
    static { this.\u0275fac = function (i) { return new (i || n); }; }
    static { this.\u0275prov = e.\u0275\u0275defineInjectable({ token: n, factory: n.\u0275fac, providedIn: "root" }); }
} return n; })(), Ui = (() => { class n {
    constructor(t, i, s, p, y, N, j, L) { t.register(ri({ pageBuilderFacade: i, formService: s, persistService: p, transversePanelpageComponentSvc: N })), t.register(oi({ dialog: y })), t.register(ai({ overlay: j, injector: L })); }
    static { this.\u0275fac = function (i) { return new (i || n)(e.\u0275\u0275inject(re.InteractionHandlerPluginManager), e.\u0275\u0275inject(F.PageBuilderFacade), e.\u0275\u0275inject(F.FormService), e.\u0275\u0275inject(He.PersistService), e.\u0275\u0275inject(K.MatDialog), e.\u0275\u0275inject(ci), e.\u0275\u0275inject(pt.Overlay), e.\u0275\u0275inject(e.Injector)); }; }
    static { this.\u0275mod = e.\u0275\u0275defineNgModule({ type: n }); }
    static { this.\u0275inj = e.\u0275\u0275defineInjector({ providers: [{ provide: _t, useValue: we, multi: !0 }, { provide: At, useClass: li }], imports: [yt, xt, It, St, Et, wt, Vt] }); }
} return n; })();
export { Bi as EmptyLayoutComponent, J as PanelPageComponent, we as PanelPageRouterComponent, Ui as RenderModule, me as RenderPaneComponent, Fe as RenderPanelComponent, ci as TransversePanelPageComponentService };
