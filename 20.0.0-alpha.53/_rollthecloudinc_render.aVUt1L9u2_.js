import { a as ye } from "@nf-internal/chunk-VJMH5IEE";
import { g as se, i as ve } from "@nf-internal/chunk-FYX6O4YR";
import { H as U, M as Oe, f as Ae, k as L, l as D, z as V } from "@nf-internal/chunk-STIBVO4O";
import { a as N, b as k } from "@nf-internal/chunk-2AVGQ2MQ";
import * as z from "@angular/common";
import { isPlatformServer as De, isPlatformBrowser as re, CommonModule as at } from "@angular/common";
import * as e from "@angular/core";
import { InjectionToken as We, forwardRef as W, DOCUMENT as ze, PLATFORM_ID as Ie, EventEmitter as ot } from "@angular/core";
import * as R from "@angular/forms";
import { NG_VALUE_ACCESSOR as he, Validators as lt, NG_ASYNC_VALIDATORS as $e, FormsModule as ct, ReactiveFormsModule as dt } from "@angular/forms";
import * as ie from "@rollthecloudinc/utils";
import { UtilsModule as pt, EMBEDDABLE_COMPONENT as ht } from "@rollthecloudinc/utils";
import * as Ke from "@rollthecloudinc/layout";
import { GridLayoutComponent as ut, LayoutModule as gt } from "@rollthecloudinc/layout";
import * as Ze from "@rollthecloudinc/media";
import { MEDIA_SETTINGS as ft } from "@rollthecloudinc/media";
import * as ue from "@rollthecloudinc/context";
import { InlineContext as _e } from "@rollthecloudinc/context";
import * as w from "@rollthecloudinc/panels";
import { PanelPageStateSlice as Le, PanelPage as Ce, PanelPageForm as He, PanelsModule as mt } from "@rollthecloudinc/panels";
import { tap as p, map as l, filter as T, switchMap as x, withLatestFrom as Ve, take as B, defaultIfEmpty as le, delay as te, startWith as Fe, debounceTime as J, distinctUntilChanged as vt, skip as Pe, bufferTime as yt, takeUntil as Ct, concatMap as qe, catchError as Pt, finalize as bt } from "rxjs/operators";
import { getRouterSelectors as Ue } from "@ngrx/router-store";
import * as Re from "@ngrx/store";
import { select as ke } from "@ngrx/store";
import * as ge from "@rollthecloudinc/sheath";
import { isSelectorValid as ce, ClassClassification as we } from "@rollthecloudinc/sheath";
import { camelize as Je } from "inflected";
import be from "deepmerge-json";
import * as Ye from "@angular/router";
import { BaseRouteReuseStrategy as St, RouteReuseStrategy as xt } from "@angular/router";
import * as Ee from "@rollthecloudinc/crud";
import * as X from "@ngrx/data";
import * as je from "@rollthecloudinc/content";
import * as Ne from "@rollthecloudinc/dparam";
import * as Xe from "@angular/common/http";
import * as et from "@rollthecloudinc/attributes";
import * as Me from "@rollthecloudinc/refinery";
import * as tt from "@rollthecloudinc/auth";
import * as ne from "@rollthecloudinc/detour";
import { InteractionHandlerPlugin as it } from "@rollthecloudinc/detour";
import * as K from "@angular/material/dialog";
import { MAT_DIALOG_DATA as It } from "@angular/material/dialog";
import * as nt from "@angular/material/button";
import { MaterialModule as $t } from "@rollthecloudinc/material";
function _t(s, o) { }
function Ft(s, o) { if (s & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page", 5), s & 2) {
    let t = e.\u0275\u0275nextContext();
    e.\u0275\u0275property("panelPage", t.panelPage)("nested", !0)("contexts", t.contexts)("css", t.filteredCss)("listeners", t.filteredListeners)("ancestory", t.ancestoryWithSelf);
} }
function Rt(s, o) { if (s & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page", 6), s & 2) {
    let t = e.\u0275\u0275nextContext();
    e.\u0275\u0275property("id", t.linkedPageId)("nested", !0)("contexts", t.contexts)("ancestory", t.ancestoryWithSelf);
} }
function wt(s, o) { if (s & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page", 5), s & 2) {
    let t = e.\u0275\u0275nextContext();
    e.\u0275\u0275property("panelPage", t.embedPanel)("nested", !0)("contexts", t.contexts)("css", t.filteredCss)("listeners", t.filteredListeners)("ancestory", t.ancestoryWithSelf);
} }
function Et(s, o) { s & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page-router"); }
var jt = ["panes"];
function Nt(s, o) { }
function Mt(s, o) { if (s & 1 && e.\u0275\u0275element(0, "classifieds-ui-render-pane", 8), s & 2) {
    let t = o.$implicit, i = o.index, r = e.\u0275\u0275nextContext(3), d = e.\u0275\u0275reference(1);
    e.\u0275\u0275property("formControlName", i)("pluginName", t.contentPlugin)("settings", t.settings)("name", t.name)("label", t.label)("originPane", r.panel.panes[r.originMappings[i]])("contexts", t.contexts)("displayType", r.displayType)("resolvedContext", t.resolvedContext)("indexPosition", i)("css", r.filteredCss)("listeners", r.filteredListeners)("ancestory", r.ancestoryWithSelf$.value)("panes", d)("originPanes", r.originPanes);
} }
function Tt(s, o) { if (s & 1 && (e.\u0275\u0275elementContainerStart(0)(1)(2, 6), e.\u0275\u0275template(3, Mt, 1, 15, "classifieds-ui-render-pane", 7), e.\u0275\u0275elementContainerEnd()()()), s & 2) {
    let t = e.\u0275\u0275nextContext(2);
    e.\u0275\u0275advance(3), e.\u0275\u0275property("ngForOf", t.resolvedPanes);
} }
function At(s, o) { if (s & 1 && e.\u0275\u0275element(0, "classifieds-ui-render-pane", 10), s & 2) {
    let t = o.$implicit, i = o.index, r = e.\u0275\u0275nextContext(3), d = e.\u0275\u0275reference(1);
    e.\u0275\u0275property("pluginName", t.contentPlugin)("settings", t.settings)("name", t.name)("label", t.label)("originPane", r.panel.panes[r.originMappings[i]])("contexts", t.contexts)("linkedPageId", t.linkedPageId)("displayType", r.displayType)("resolvedContext", t.resolvedContext)("indexPosition", i)("css", r.filteredCss)("listeners", r.filteredListeners)("ancestory", r.ancestoryWithSelf$.value)("panes", d)("originPanes", r.originPanes);
} }
function Ot(s, o) { if (s & 1 && (e.\u0275\u0275elementContainerStart(0), e.\u0275\u0275template(1, At, 1, 15, "classifieds-ui-render-pane", 9), e.\u0275\u0275elementContainerEnd()), s & 2) {
    let t = e.\u0275\u0275nextContext(2);
    e.\u0275\u0275advance(), e.\u0275\u0275property("ngForOf", t.resolvedPanes);
} }
function Dt(s, o) { if (s & 1 && (e.\u0275\u0275elementContainerStart(0)(1, 4), e.\u0275\u0275template(2, Tt, 4, 1, "ng-container", 5)(3, Ot, 2, 1, "ng-container", 5), e.\u0275\u0275elementContainerEnd()()), s & 2) {
    let t = e.\u0275\u0275nextContext();
    e.\u0275\u0275advance(), e.\u0275\u0275property("ngSwitch", t.displayType), e.\u0275\u0275advance(), e.\u0275\u0275property("ngSwitchCase", "form"), e.\u0275\u0275advance(), e.\u0275\u0275property("ngSwitchCase", "page");
} }
var Lt = ["renderPanelTpl"];
function Ht(s, o) { }
function Vt(s, o) { if (s & 1 && (e.\u0275\u0275elementContainerStart(0, 1)(1, 3), e.\u0275\u0275element(2, "classifieds-ui-render-panel", 4), e.\u0275\u0275elementContainerEnd()()), s & 2) {
    let t = o.i, i = e.\u0275\u0275nextContext();
    e.\u0275\u0275property("formGroup", i.pageForm), e.\u0275\u0275advance(2), e.\u0275\u0275property("formControlName", t)("panel", i.panelPageCached.panels[t])("nested", i.nested$.value)("contexts", i.contexts$.value)("resolvedContext", i.resolvedContext)("contextsChanged", i.contextsChanged)("displayType", i.panelPageCached.displayType)("indexPosition", t)("css", i.filteredCss)("listeners", i.filteredListeners)("ancestory", i.ancestory$.value);
} }
var de = (() => { class s {
    constructor(t) { this.viewContainerRef = t; }
    static { this.\u0275fac = function (i) { return new (i || s)(e.\u0275\u0275directiveInject(e.ViewContainerRef)); }; }
    static { this.\u0275dir = e.\u0275\u0275defineDirective({ type: s, selectors: [["", "classifiedsUiPaneContentHost", ""]], standalone: !1 }); }
} return s; })(), Be = (() => { class s {
    constructor(t) { this.viewContainerRef = t; }
    static { this.\u0275fac = function (i) { return new (i || s)(e.\u0275\u0275directiveInject(e.ViewContainerRef)); }; }
    static { this.\u0275dir = e.\u0275\u0275defineDirective({ type: s, selectors: [["", "classifiedsUiLayoutRendererHost", ""]], standalone: !1 }); }
} return s; })(), Ge = new We("RenderPaneToken"), Qe = new We("PanelPageRouterToken"), Se = (() => { class s {
    constructor(t, i, r, d, m, A, O, G) { this.panelPageRouterComponent = t, this.route = i, this.pageBuilderFacade = r, this.routerStore = d, this.asyncApiCallHelperSvc = m, this.crudDataHelperService = A, this.entityDefinitionService = O, this.yield = !!this.panelPageRouterComponent, this.onTouched = () => { }, this.paramMapSub = this.route.paramMap.pipe(p(() => console.log("param map panelPageId")), l(C => C.get("panelPageId")), T(C => C !== void 0), x(() => this.route.data), Ve(this.routerStore.pipe(ke(Ue(C => C.router).selectCurrentRoute), l(C => C.params), B(1))), p(([C, M]) => console.log("panel page router param map", C.panelPageListItem.id, M)), l(([C, M]) => [C.panelPageListItem.id, M, C.path]), p(([C, M, c]) => console.log("panel page router param map 2", C, M, c)), x(([C, M, c]) => this.yield ? V([C, M, void 0]) : this.crudDataHelperService.evaluateCollectionPlugins({ query: void 0, plugins: this.entityDefinitionService.getDefinition("PanelPage").metadata.crud, op: "query" }).pipe(l(f => f.filter(_ => _.path === "*")), l(f => f && f.length ? f[0].id : void 0), l(f => [C, M, c, f]), le([C, M, c, void 0]))), p(([C, M, c, f]) => { console.log("route page"); let _ = "/pages/panelpage/" + C; this.pageBuilderFacade.setPageInfo(new Le({ id: C, realPath: _, path: c, args: M })), this.panelPageId = C, f !== void 0 && f !== this.routePanelPageId && (this.routePanelPageId = f), console.log("router panelPageId", this.panelPageId), console.log("router routePanelPageId", this.routePanelPageId); })).subscribe(), this.panelPageService = G.getEntityCollectionService("PanelPage"); }
    writeValue(t) { }
    registerOnChange(t) { }
    registerOnTouched(t) { this.onTouched = t; }
    setDisabledState(t) { }
    ngOnInit() { if (!this.yield) {
        let { selectCurrentRoute: t } = Ue(i => i.router);
        this.route.paramMap.pipe(p(() => console.log("param map page builder facade info")), Ve(this.pageBuilderFacade.getPageInfo$), T(([i, r]) => r !== void 0 && i.get("panelPageId") !== void 0 && i.get("panelPageId") === r.id), x(([i, r]) => this.routerStore.pipe(ke(t), l(d => [r, d.params]), B(1)))).subscribe(([i, r]) => { this.pageBuilderFacade.setPageInfo(new Le(k(N({}, i), { args: r }))); });
    } }
    static { this.\u0275fac = function (i) { return new (i || s)(e.\u0275\u0275directiveInject(Qe, 12), e.\u0275\u0275directiveInject(Ye.ActivatedRoute), e.\u0275\u0275directiveInject(w.PageBuilderFacade), e.\u0275\u0275directiveInject(Re.Store), e.\u0275\u0275directiveInject(ie.AsyncApiCallHelperService), e.\u0275\u0275directiveInject(Ee.CrudDataHelperService), e.\u0275\u0275directiveInject(X.EntityDefinitionService), e.\u0275\u0275directiveInject(X.EntityServices)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: s, selectors: [["classifieds-ui-panel-page-router"]], standalone: !1, features: [e.\u0275\u0275ProvidersFeature([{ provide: he, useExisting: W(() => s), multi: !0 }, { provide: Qe, useExisting: W(() => s) }])], decls: 1, vars: 1, consts: [[3, "id"]], template: function (i, r) { i & 1 && e.\u0275\u0275element(0, "classifieds-ui-panel-page", 0), i & 2 && e.\u0275\u0275property("id", r.routePanelPageId ?? r.panelPageId); }, dependencies: () => [Y], encapsulation: 2 }); }
} return s; })(), pe = (() => { class s {
    set resolvedContext(t) { this.resolvedContext$.next(t); }
    set css(t) { this.css$.next(t); }
    set listeners(t) { this.listeners$.next(t); }
    get indexPositionClass() { return `pane-${this.indexPosition}`; }
    get dynamicPanel() { return new Ce(this.resolvedContext._root); }
    constructor(t, i, r, d, m, A, O, G, C, M, c, f, _, P) { this.document = t, this.platformId = i, this.renderPaneComponent = r, this.el = d, this.renderer2 = m, this.componentFactoryResolver = A, this.panelHandler = O, this.fb = G, this.cpm = C, this.cssHelper = M, this.paneStateService = c, this.paramEvaluatorService = f, this.renderer = _, this.settings = [], this.ancestory = [], this.panes = [], this.originPanes = [], this.yield = !!this.renderPaneComponent, this.afterContentInit$ = new L, this.resolvedContext$ = new D({}), this.schedulePluginChange = new L, this.ancestoryWithSelf = [], this.filteredListeners = [], this.css$ = new D({ css: this.cssHelper.makeJsonNode(), classes: {} }), this.cssSub = U([this.css$, this.afterContentInit$, this.schedulePluginChange]).pipe(l(([a]) => a), l(a => ({ css: this.cssHelper.reduceCss(a.css, `.pane-${this.indexPosition}`), classes: this.cssHelper.reduceSelector(a.classes, `.pane-${this.indexPosition}`) })), l(({ css: a, classes: u }) => [this.cssHelper.reduceCss(a, ".panel-page", !1), this.cssHelper.reduceCss(a, ".panel-page"), this.cssHelper.reduceSelector(u, ".panel-page", !1), this.cssHelper.reduceSelector(u, ".panel-page")]), p(([a, u, v, I]) => this.filteredCss = { css: u, classes: I }), l(([a, u, v, I]) => ({ css: a, classes: v })), l(({ css: a, classes: u }) => { let v = Object.keys(a.children).reduce((g, y) => N(N({}, g), y.indexOf(">") === 0 ? { [this.ancestoryWithSelf.map((S, E) => (E + 1) % 2 === 0 ? `.pane-${S}` : `.panel-${S}`).join(" ") + " " + y]: u[y] } : { [y]: u[y] }), {}), I = Object.keys(u).reduce((g, y) => N(N({}, g), y.indexOf(">") === 0 ? { [this.ancestoryWithSelf.map((S, E) => (E + 1) % 2 === 0 ? `.pane-${S}` : `.panel-${S}`).join(" ") + " " + y]: u[y] } : { [y]: u[y] }), {}); return { css: { children: v }, classes: I }; }), te(500)).subscribe(({ css: a, classes: u }) => { console.log("reduced classes", u); let v = Object.keys(a.children).filter(g => g === "" || ce({ selector: g, document: this.document })), I = Object.keys(u).filter(g => g === "" || ce({ selector: g, document: this.document })); I.forEach((g, y) => { let S = g === "" ? [this.el.nativeElement] : g.indexOf(">") !== -1 ? this.document.querySelectorAll(g) : this.el.nativeElement.querySelectorAll(g), E = S.length; for (let $ = 0; $ < E; $++) {
        let H = u[I[y]], q = Object.keys(H), fe = q.length;
        for (let Q = 0; Q < fe; Q++)
            S[$] && (H[q[Q]] === we.REMOVE ? (console.log(`remove class ${q[Q]}`), this.renderer2.removeClass(S[$], q[Q])) : (console.log(`add class ${q[Q]}`), this.renderer2.addClass(S[$], q[Q])));
    } }), v.forEach(g => { console.log(`search: ${g}`); let y = g === "" ? [this.el.nativeElement] : g.indexOf(">") !== -1 ? this.document.querySelectorAll(g) : this.el.nativeElement.querySelectorAll(g), S = y.length, E = Object.keys(a.children[g].attributes); for (let $ = 0; $ < S; $++)
        y[$] && E.forEach(H => { console.log(`${g} { ${H}: ${a.children[g].attributes[H]}; }`); let q = Je(H.replace("-", "_"), !1); this.renderer2.setStyle(y[$], q, a.children[g].attributes[H]); }); }); }), this.listeners$ = new D([]), this.listenersSub = U([this.listeners$, this.schedulePluginChange]).pipe(l(([a]) => a), p(a => { this.filteredListeners = a, console.log("pane listeners", a); })).subscribe(), this.wireListenersSub = U([this.listeners$, this.afterContentInit$]).pipe(te(1), x(() => se(this.filteredListeners.map(a => V({}).pipe(l(() => ({ paramNames: a.event.settings.paramsString ? a.event.settings.paramsString.split("&").filter(u => u.indexOf("=:") !== -1).map(u => u.split("=", 2)[1].substr(1)) : [] })), x(({ paramNames: u }) => this.paramEvaluatorService.paramValues(a.event.settings.params.reduce((v, I, g) => new Map([...v, [u[g], I]]), new Map)).pipe(l(v => Array.from(v).reduce((I, [g, y]) => k(N({}, I), { [g]: y }), {})))), le([]))))), p(a => { console.log("listener info", this.filteredListeners, a); let u = this.filteredListeners.length; for (let v = 0; v < u; v++) {
        let I = this.el.nativeElement.querySelectorAll(a[v].target);
        console.log("listener target", I), I.forEach(g => this.renderer.listen(g, a[v].type, y => { if (console.log("listener fired"), this.filteredListeners[v].handler.settings.params) {
            let S = this.filteredListeners[v].handler.settings.paramsString ? this.filteredListeners[v].handler.settings.paramsString.split("&").filter(E => E.indexOf("=:") !== -1).map(E => E.split("=", 2)[1].substr(1)) : [];
            this.paramEvaluatorService.paramValues(this.filteredListeners[v].handler.settings.params.reduce((E, $, H) => new Map([...E, [S[H], $]]), new Map)).pipe(l(E => Array.from(E).reduce(($, [H, q]) => k(N({}, $), { [H]: q }), {}))).subscribe(E => { console.log("handler original event and params", y, E); });
        }
        else
            console.log("handler original event and params", y); }));
    } })).subscribe(), this.paneForm = this.fb.group({ contentPlugin: this.fb.control("", lt.required), name: this.fb.control(""), label: this.fb.control(""), settings: this.fb.control("") }), this.paneFormSub = this.paneForm.valueChanges.subscribe(a => { console.log(`pane form value plugin: ${this.pluginName}`), console.log(a); }), this.scheduleStateChange$ = new L, this.scheduleStateChangeSub = this.scheduleStateChange$.pipe(x(({ state: a }) => this.paneStateService.mergeState({ state: a, ancestory: [...this.ancestoryWithSelf], settings: this.settings, plugin: this.contentPlugin }))).subscribe(({ pageState: a }) => { this.panelPageStateService.upsert(a); }), this.onTouched = () => { }, this.pluginChangeSub = this.schedulePluginChange.pipe(T(() => this.pluginName && this.pluginName !== null && this.pluginName !== ""), x(() => this.cpm.getPlugin(this.pluginName))).subscribe(a => { this.contentPlugin = a, this.paneForm.get("contentPlugin").setValue(a.name), this.paneForm.get("name").setValue(this.name), this.paneForm.get("label").setValue(this.label), this.pluginName === "panel" ? this.resolveNestedPanelPage() : this.pluginName !== "yield" && this.renderPaneContent(); }), this.embedPanelSub = this.resolvedContext$.pipe(l(a => { a && a._root && !this.linkedPageId && this.settings.length === 0 && (this.embedPanel = new Ce(a._root)); })).subscribe(), this.panelPageStateService = P.getEntityCollectionService("PanelPageState"); }
    ngOnInit() { this.ancestoryWithSelf = [...this.ancestory ? this.ancestory : [], ...this.indexPosition !== void 0 && this.indexPosition !== null ? [this.indexPosition] : []], this.schedulePluginChange.next(void 0); }
    ngOnChanges(t) { if (t.ancestory || t.indexPosition) {
        let i = [...t.ancestory.currentValue ? t.ancestory.currentValue : this.ancestory ? this.ancestory : [], ...t.indexPosition.currentValue !== void 0 && t.indexPosition.currentValue !== null ? [t.indexPosition.currentValue] : this.indexPosition ? [this.indexPosition] : []];
        (i.length !== this.ancestoryWithSelf.length || this.ancestoryWithSelf.filter((r, d) => i[d] !== r).length !== 0) && (this.ancestoryWithSelf = i);
    } this.schedulePluginChange.next(void 0); }
    ngAfterContentInit() { this.afterContentInit$.next(void 0); }
    writeValue(t) { t && this.paneForm.setValue(t, { emitEvent: !1 }); }
    registerOnChange(t) { this.paneForm.valueChanges.subscribe(t); }
    registerOnTouched(t) { this.onTouched = t; }
    setDisabledState(t) { t ? this.paneForm.disable() : this.paneForm.enable(); }
    validate(t) { return this.paneForm.statusChanges.pipe(Fe(this.paneForm.status), T(i => i !== "PENDING"), J(1), B(1), l(i => this.paneForm.valid ? null : { invalidForm: { invalidForm: { valid: !1, message: "pane is invalid" } } })); }
    resolveNestedPanelPage() { this.panelHandler.toObject(this.settings).subscribe(t => { this.panelPage = new Ce(k(N({}, t), { contexts: this.contexts })); }); }
    renderPaneContent() { console.log("NG01203: render pane content"); let t = this.componentFactoryResolver.resolveComponentFactory(this.contentPlugin.renderComponent), i = this.contentPaneHost.viewContainerRef; i.clear(), this.componentRef = i.createComponent(t); let r = this.componentRef.instance; r.settings = this.settings, r.name = this.name, r.label = this.label, r.panes = this.panes, r.originPanes = this.originPanes, r.contexts = this.contexts ? this.contexts.map(d => new _e(d)) : [], r.displayType = this.displayType, r.resolvedContext = this.resolvedContext$.value, r.ancestory = this.ancestoryWithSelf, this.componentRef.instance.state && this.contentPlugin.handler && this.contentPlugin.handler.stateDefinition(this.settings).pipe(B(1)).subscribe(d => { this.componentRef.instance.state = d || {}; }), this.componentRef.instance.stateChange && this.componentRef.instance.stateChange.subscribe(d => { this.scheduleStateChange$.next({ state: d }); }); }
    static { this.\u0275fac = function (i) { return new (i || s)(e.\u0275\u0275directiveInject(ze), e.\u0275\u0275directiveInject(Ie), e.\u0275\u0275directiveInject(Ge, 12), e.\u0275\u0275directiveInject(e.ElementRef), e.\u0275\u0275directiveInject(e.Renderer2), e.\u0275\u0275directiveInject(e.ComponentFactoryResolver), e.\u0275\u0275directiveInject(w.PanelContentHandler), e.\u0275\u0275directiveInject(R.UntypedFormBuilder), e.\u0275\u0275directiveInject(je.ContentPluginManager), e.\u0275\u0275directiveInject(w.CssHelperService), e.\u0275\u0275directiveInject(w.PaneStateService), e.\u0275\u0275directiveInject(Ne.ParamEvaluatorService), e.\u0275\u0275directiveInject(e.Renderer2), e.\u0275\u0275directiveInject(X.EntityServices)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: s, selectors: [["classifieds-ui-render-pane"]], viewQuery: function (i, r) { if (i & 1 && (e.\u0275\u0275viewQuery(de, 7), e.\u0275\u0275viewQuery(Se, 5), e.\u0275\u0275viewQuery(Y, 5)), i & 2) {
            let d;
            e.\u0275\u0275queryRefresh(d = e.\u0275\u0275loadQuery()) && (r.contentPaneHost = d.first), e.\u0275\u0275queryRefresh(d = e.\u0275\u0275loadQuery()) && (r.panelPageRouterComponent = d.first), e.\u0275\u0275queryRefresh(d = e.\u0275\u0275loadQuery()) && (r.panelPageComponent = d.first);
        } }, hostVars: 5, hostBindings: function (i, r) { i & 2 && (e.\u0275\u0275attribute("data-index", r.indexPosition), e.\u0275\u0275classMap(r.indexPositionClass), e.\u0275\u0275classProp("pane", !0)); }, inputs: { pluginName: "pluginName", settings: "settings", linkedPageId: "linkedPageId", contexts: "contexts", originPane: "originPane", displayType: "displayType", name: "name", label: "label", indexPosition: "indexPosition", ancestory: "ancestory", panes: "panes", originPanes: "originPanes", resolvedContext: "resolvedContext", css: "css", listeners: "listeners" }, standalone: !1, features: [e.\u0275\u0275ProvidersFeature([{ provide: he, useExisting: W(() => s), multi: !0 }, { provide: $e, useExisting: W(() => s), multi: !0 }, { provide: Ge, useExisting: W(() => s) }]), e.\u0275\u0275NgOnChangesFeature], decls: 7, vars: 5, consts: [[3, "formGroup"], ["classifiedsUiPaneContentHost", ""], ["formControlName", "settings", 3, "panelPage", "nested", "contexts", "css", "listeners", "ancestory", 4, "ngIf"], ["formControlName", "settings", 3, "id", "nested", "contexts", "ancestory", 4, "ngIf"], [4, "ngIf"], ["formControlName", "settings", 3, "panelPage", "nested", "contexts", "css", "listeners", "ancestory"], ["formControlName", "settings", 3, "id", "nested", "contexts", "ancestory"]], template: function (i, r) { i & 1 && (e.\u0275\u0275elementStart(0, "div", 0), e.\u0275\u0275elementContainerStart(1), e.\u0275\u0275template(2, _t, 0, 0, "ng-template", 1), e.\u0275\u0275elementContainerEnd(), e.\u0275\u0275template(3, Ft, 1, 6, "classifieds-ui-panel-page", 2)(4, Rt, 1, 4, "classifieds-ui-panel-page", 3)(5, wt, 1, 6, "classifieds-ui-panel-page", 2)(6, Et, 1, 0, "classifieds-ui-panel-page-router", 4), e.\u0275\u0275elementEnd()), i & 2 && (e.\u0275\u0275property("formGroup", r.paneForm), e.\u0275\u0275advance(3), e.\u0275\u0275property("ngIf", r.pluginName == "panel" && !r.linkedPageId && r.settings.length !== 0), e.\u0275\u0275advance(), e.\u0275\u0275property("ngIf", r.pluginName == "panel" && r.linkedPageId), e.\u0275\u0275advance(), e.\u0275\u0275property("ngIf", r.pluginName == "panel" && !r.linkedPageId && r.settings.length === 0), e.\u0275\u0275advance(), e.\u0275\u0275property("ngIf", r.pluginName == "yield")); }, dependencies: () => [z.NgIf, R.NgControlStatus, R.NgControlStatusGroup, R.FormGroupDirective, R.FormControlName, de, Y, Se], styles: ["[_nghost-%COMP%]{height:100%}"] }); }
} return s; })(), xe = (() => { class s {
    static { this.COUNTER = 0; }
    set contextChanged(t) { }
    set contextsChanged(t) { t.map(i => this.schduleContextChange.next(i)); }
    set indexPosition(t) { this.indexPosition$.next(t); }
    set ancestory(t) { this.ancestory$.next(t); }
    set css(t) { this.css$.next(t); }
    set listeners(t) { this.listeners$.next(t); }
    get indexPositionClass() { return `panel-${this.indexPosition$.value}`; }
    get panesArray() { return this.panelForm.get("panes"); }
    constructor(t, i, r, d, m, A, O, G, C, M) { this.platformId = t, this.document = i, this.hostEl = r, this.renderer2 = d, this.componentFactoryResolver = m, this.fb = A, this.panelResolverService = O, this.spm = G, this.cssHelper = C, this.styleResolverService = M, this.nested = !1, this.resolvedContext = {}, this.heightChange = new ot, this.panelForm = this.fb.group({ name: this.fb.control(""), label: this.fb.control(""), panes: this.fb.array([]) }), this.panelFormSub = this.panelForm.valueChanges.subscribe(c => { console.log("paneL form value"), console.log(c); }), this.filteredListeners = [], this.afterContentInit$ = new L, this.schedulePanelRender = new L, this.rendered$ = new L, this.css$ = new D({ css: this.cssHelper.makeJsonNode(), classes: {} }), this.cssSub = U([this.css$, this.afterContentInit$, this.rendered$]).pipe(p(([c]) => console.log("css node", c.css)), l(([c]) => c), l(c => ({ css: this.cssHelper.reduceCss(c.css, `.panel-${this.indexPosition$.value}`), classes: this.cssHelper.reduceSelector(c.classes, `.panel-${this.indexPosition$.value}`) })), l(({ css: c, classes: f }) => [this.cssHelper.reduceCss(c, ".pane-", !1), c, this.cssHelper.reduceSelector(f, ".pane-", !1), f]), p(([c, f, _, P]) => this.filteredCss = { css: f, classes: P }), l(([c, f, _]) => ({ css: c, classes: _ })), l(({ css: c, classes: f }) => { let _ = Object.keys(c.children).reduce((a, u) => N(N({}, a), u.indexOf(">") === 0 ? { [this.ancestoryWithSelf$.value.map((v, I) => (I + 1) % 2 === 0 ? `.pane-${v}` : `.panel-${v}`).join(" ") + " " + u]: f[u] } : { [u]: f[u] }), {}), P = Object.keys(f).reduce((a, u) => N(N({}, a), u.indexOf(">") === 0 ? { [this.ancestoryWithSelf$.value.map((v, I) => (I + 1) % 2 === 0 ? `.pane-${v}` : `.panel-${v}`).join(" ") + " " + u]: f[u] } : { [u]: f[u] }), {}); return { css: { children: _ }, classes: P }; }), te(1)).subscribe(({ css: c, classes: f }) => { console.log("classes", f); let _ = Object.keys(c.children).filter(a => a === "" || ce({ selector: a, document: this.document })), P = Object.keys(f).filter(a => a === "" || ce({ selector: a, document: this.document })); P.forEach((a, u) => { let v = a === "" ? [this.hostEl.nativeElement] : a.indexOf(">") !== -1 ? this.document.querySelectorAll(a) : this.hostEl.nativeElement.querySelectorAll(a), I = v.length; for (let g = 0; g < I; g++) {
        let y = f[P[u]], S = Object.keys(y), E = S.length;
        for (let $ = 0; $ < E; $++)
            v[g] && (y[S[$]] === we.REMOVE ? (console.log(`remove class ${S[$]}`), this.renderer2.removeClass(v[g], S[$])) : (console.log(`add class ${S[$]}`), this.renderer2.addClass(v[g], S[$])));
    } }), _.forEach(a => { console.log(`search: ${a}`); let u = a === "" ? [this.hostEl.nativeElement] : a.indexOf(">") !== -1 ? this.document.querySelectorAll(a) : this.hostEl.nativeElement.querySelectorAll(a), v = u.length, I = Object.keys(c.children[a].attributes); for (let g = 0; g < v; g++)
        u[g] && I.forEach(y => { console.log(`${a} { ${y}: ${c.children[a].attributes[y]}; }`); let S = Je(y.replace("-", "_"), !1); this.renderer2.setStyle(u[g], S, c.children[a].attributes[y]); }); }); }), this.listeners$ = new D([]), this.listenersSub = this.listeners$.pipe(p(c => { console.log("panel listeners", c), this.filteredListeners = c; })).subscribe(), this.scheduleRender = new L, this.scheduleRenderSub = this.scheduleRender.pipe(p(() => console.log(`schdule renderer before [${this.panel.name}]`)), x(([c, f, _]) => this.panelResolverService.resolvePanes({ panes: c, contexts: f, resolvedContext: _ }).pipe(l(({ resolvedPanes: P, originMappings: a }) => ({ resolvedPanes: P, originMappings: a, panes: c })))), x(({ panes: c, resolvedPanes: f, originMappings: _ }) => this.styleResolverService.alterResolvedPanes({ panel: this.panel, resolvedPanes: f, originMappings: _ }).pipe(l(({ resolvedPanes: P, originMappings: a }) => ({ panes: c, resolvedPanes: P, originMappings: a })))), p(() => console.log(`schdule renderer after [${this.panel.name}]`))).subscribe(({ panes: c, resolvedPanes: f, originMappings: _ }) => { console.log(`render panel: ${this.panel.name}`), this.resolvedPanes = f, this.originPanes = c, this.originMappings = _, this.paneContainer && this.stylePlugin, this.populatePanesFormArray(), this.stylePlugin !== void 0 ? this.renderPanelContent() : this.rendered$.next(void 0); }), this.schduleContextChange = new L, this.schedulePanelRenderSub = this.schedulePanelRender.pipe(x(c => this.spm.getPlugin(c))).subscribe(c => { let f = this.componentFactoryResolver.resolveComponentFactory(c.renderComponent), _ = this.panelHost.viewContainerRef; _.clear(); let P = _.createComponent(f); this.componentRef = P, P.instance.settings = this.panel.settings, P.instance.panes = this.resolvedPanes, P.instance.originPanes = this.panel.panes, P.instance.originMappings = this.originMappings, P.instance.contexts = this.contexts.map(a => new _e(a)), P.instance.displayType = this.displayType, P.instance.ancestory = this.ancestoryWithSelf$.value, P.instance.resolvedContext = this.resolvedContext, P.instance.panel = this.panel, P.instance.indexPosition = this.indexPosition$.value, P.instance.filteredListeners = this.filteredListeners, P.instance.filteredCss = this.filteredCss, this.rendered$.next(void 0); }), this.originMappings = [], this.resolvedContexts = [], this.ancestoryWithSelf$ = new D([]), this.ancestory$ = new D([]), this.indexPosition$ = new D(void 0), this.onTouched = () => { }, this.ancestorySub = U([this.ancestory$, this.indexPosition$]).pipe(p(([c, f]) => { this.ancestoryWithSelf$.next([...c, f]); })).subscribe(), this.counter = s.COUNTER++; }
    ngOnInit() { this.stylePlugin = this.panel.stylePlugin !== void 0 && this.panel.stylePlugin !== "" ? this.panel.stylePlugin : void 0, this.panel !== void 0 && this.panelHost !== void 0 && (console.log(`panel render init [${this.panel.name}`), this.panelResolverService.usedContexts(this.panel.panes).pipe(l(t => t.filter(i => i !== "_page" && i !== "_root" && i !== "." && i.indexOf("panestate-" + this.ancestoryWithSelf$.value.join("-")) !== 0)), p(t => console.log(`contexts [${this.panel.name}]: ${t.join(",")}`)), x(t => this.schduleContextChange.pipe(p(i => console.log(`detected change [${this.panel.name}]: ${i}`)), l(i => [t, i]))), p(([t, i]) => console.log(`detected change [${this.panel.name}]: ${i} : ctx: ${t.join(",")}`)), T(([t, i]) => Array.isArray(t) && t.findIndex(r => r === i) !== -1), J(100)).subscribe(([t, i]) => { console.log(`Context changed [${this.panel.name}]: ${i}`), console.log(`contexts detected [${this.panel.name}]: ${t.join(",")}`), this.scheduleRender.next([this.panel.panes, this.contexts, this.resolvedContext]); })); }
    ngOnChanges(t) { this.stylePlugin = this.panel.stylePlugin !== void 0 && this.panel.stylePlugin !== "" ? this.panel.stylePlugin : void 0, t.resolvedContext && t.resolvedContext.previousValue === void 0 && this.scheduleRender.next([this.panel.panes, this.contexts, this.resolvedContext]); }
    ngAfterViewInit() { }
    ngAfterContentInit() { this.afterContentInit$.next(void 0); }
    writeValue(t) { t && this.panelForm.setValue(t, { emitEvent: !1 }); }
    registerOnChange(t) { this.panelForm.valueChanges.subscribe(t); }
    registerOnTouched(t) { this.onTouched = t; }
    setDisabledState(t) { t ? this.panelForm.disable() : this.panelForm.enable(); }
    validate(t) { return this.panelForm.statusChanges.pipe(Fe(this.panelForm.status), T(i => i !== "PENDING"), J(1), B(1), l(i => this.panelForm.valid ? null : { invalidForm: { valid: !1, message: "panel are invalid" } })); }
    populatePanesFormArray() { this.panesArray.clear(), this.resolvedPanes.forEach((t, i) => { this.panesArray.push(this.fb.control("")); }); }
    renderPanelContent() { this.schedulePanelRender.next(this.stylePlugin); }
    static { this.\u0275fac = function (i) { return new (i || s)(e.\u0275\u0275directiveInject(Ie), e.\u0275\u0275directiveInject(ze), e.\u0275\u0275directiveInject(e.ElementRef), e.\u0275\u0275directiveInject(e.Renderer2), e.\u0275\u0275directiveInject(e.ComponentFactoryResolver), e.\u0275\u0275directiveInject(R.UntypedFormBuilder), e.\u0275\u0275directiveInject(w.PanelResolverService), e.\u0275\u0275directiveInject(w.StylePluginManager), e.\u0275\u0275directiveInject(w.CssHelperService), e.\u0275\u0275directiveInject(w.StyleResolverService)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: s, selectors: [["classifieds-ui-render-panel"]], viewQuery: function (i, r) { if (i & 1 && (e.\u0275\u0275viewQuery(de, 7), e.\u0275\u0275viewQuery(jt, 7), e.\u0275\u0275viewQuery(pe, 5)), i & 2) {
            let d;
            e.\u0275\u0275queryRefresh(d = e.\u0275\u0275loadQuery()) && (r.panelHost = d.first), e.\u0275\u0275queryRefresh(d = e.\u0275\u0275loadQuery()) && (r.paneContainer = d.first), e.\u0275\u0275queryRefresh(d = e.\u0275\u0275loadQuery()) && (r.renderedPanes = d);
        } }, hostVars: 5, hostBindings: function (i, r) { i & 2 && (e.\u0275\u0275attribute("data-index", r.indexPosition$.value), e.\u0275\u0275classMap(r.indexPositionClass), e.\u0275\u0275classProp("panel", !0)); }, inputs: { panel: "panel", contexts: "contexts", nested: "nested", displayType: "displayType", resolvedContext: "resolvedContext", contextChanged: "contextChanged", contextsChanged: "contextsChanged", indexPosition: "indexPosition", ancestory: "ancestory", css: "css", listeners: "listeners" }, outputs: { heightChange: "heightChange" }, standalone: !1, features: [e.\u0275\u0275ProvidersFeature([{ provide: he, useExisting: W(() => s), multi: !0 }, { provide: $e, useExisting: W(() => s), multi: !0 }]), e.\u0275\u0275NgOnChangesFeature], decls: 5, vars: 2, consts: [["panes", ""], [1, "render-panel", 3, "formGroup"], ["classifiedsUiPaneContentHost", ""], [4, "ngIf"], [3, "ngSwitch"], [4, "ngSwitchCase"], ["formArrayName", "panes"], [3, "formControlName", "pluginName", "settings", "name", "label", "originPane", "contexts", "displayType", "resolvedContext", "indexPosition", "css", "listeners", "ancestory", "panes", "originPanes", 4, "ngFor", "ngForOf"], [3, "formControlName", "pluginName", "settings", "name", "label", "originPane", "contexts", "displayType", "resolvedContext", "indexPosition", "css", "listeners", "ancestory", "panes", "originPanes"], [3, "pluginName", "settings", "name", "label", "originPane", "contexts", "linkedPageId", "displayType", "resolvedContext", "indexPosition", "css", "listeners", "ancestory", "panes", "originPanes", 4, "ngFor", "ngForOf"], [3, "pluginName", "settings", "name", "label", "originPane", "contexts", "linkedPageId", "displayType", "resolvedContext", "indexPosition", "css", "listeners", "ancestory", "panes", "originPanes"]], template: function (i, r) { i & 1 && (e.\u0275\u0275elementStart(0, "div", 1, 0), e.\u0275\u0275elementContainerStart(2), e.\u0275\u0275template(3, Nt, 0, 0, "ng-template", 2), e.\u0275\u0275elementContainerEnd(), e.\u0275\u0275template(4, Dt, 4, 3, "ng-container", 3), e.\u0275\u0275elementEnd()), i & 2 && (e.\u0275\u0275property("formGroup", r.panelForm), e.\u0275\u0275advance(4), e.\u0275\u0275property("ngIf", !r.stylePlugin && r.resolvedPanes)); }, dependencies: [z.NgForOf, z.NgIf, z.NgSwitch, z.NgSwitchCase, R.NgControlStatus, R.NgControlStatusGroup, R.FormGroupDirective, R.FormControlName, R.FormArrayName, de, pe], styles: ["[_nghost-%COMP%]{height:100%}.render-panel[_ngcontent-%COMP%]{height:100%}"] }); }
} return s; })(), Y = class s {
    static { this.registredContextListeners = new Set; }
    set id(o) { this.id$.next(o); }
    set panelPage(o) { this.panelPage$.next(o); }
    set nested(o) { this.nested$.next(o); }
    set contexts(o) { this.contexts$.next(o); }
    set ancestory(o) { this.ancestory$.next(o); }
    set css(o) { this.css$.next(o); }
    set listeners(o) { this.listeners$.next(o); }
    get panelsArray() { return this.pageForm.get("panels"); }
    constructor(o, t, i, r, d, m, A, O, G, C, M, c, f, _, P, a, u, v, I, g, y, S, E, $, H, q, fe, Q, st, rt, me) {
        this.platformId = o, this.mediaSettings = t, this.routerStore = i, this.fb = r, this.el = d, this.inlineContextResolver = m, this.pageBuilderFacade = A, this.cpm = O, this.cxm = G, this.lpm = C, this.componentFactoryResolver = M, this.styleLoader = c, this.http = f, this.cssHelper = _, this.attributeSerializer = P, this.formService = a, this.panelsContextService = u, this.asyncApiCallHelperSvc = v, this.crudDataHelperService = I, this.entityDefinitionService = g, this.ngZone = y, this.persistService = S, this.stylizerService = E, this.classifyService = $, this.fileService = H, this.authFacade = q, this.paramEvaluatorService = fe, this.renderer = Q, this.iepm = st, this.ihpm = rt, this.resolvedContext = {}, this.contextsChanged = [], this.persistenceEnabled = !1, this.onInit$ = new L, this.afterViewInit$ = new L, this.afterContentInit$ = new L, this.renderLayout$ = new L, this.id$ = new D(void 0), this.panelPage$ = new D(void 0), this.nested$ = new D(!1), this.ancestory$ = new D([]), this.contexts$ = new D([]), this.instanceUniqueIdentity = ye(), this.isStable = !1, this.managedCssCache = "", this.managedClassesCache = {}, this.filteredListeners = [], this.css$ = new D({ css: this.cssHelper.makeJsonNode(), classes: {} }), this.cssSub = this.css$.subscribe(n => { this.nested$.value && console.log("filtered css nested", n), this.filteredCss = n; }), this.listeners$ = new D([]), this.listenersSub = this.listeners$.pipe(p(n => { this.filteredListeners = n; })).subscribe(), this.settingsFormArray = this.fb.array([]), this.pageForm = this.fb.group({ panels: this.fb.array([]) }), this.bridgeSub = this.pageForm.valueChanges.pipe(T(() => this.nested$.value), J(500)).subscribe(n => { console.log("write page"), console.log(n), this.settingsFormArray.clear(); let h = this.attributeSerializer.convertToGroup(this.attributeSerializer.serialize(n, "value").attributes[0]); this.settingsFormArray.push(h), console.log(h.value); }), this.idOrPanelPageSub = U([this.id$, this.panelPage$]).pipe(vt(), l(([n, h]) => ({ id: n, panelPage: h })), T(({ id: n, panelPage: h }) => !!n || !!h), x(({ id: n, panelPage: h }) => ve(() => !n, V({ panelPage: h }), new Ae(F => { let j = this.entityDefinitionService.getDefinition("PanelPage").metadata; return this.crudDataHelperService.evaluateCollectionPlugins({ query: `identity=${n}`, plugins: j.crud, op: "query" }).pipe(l(b => b && b.length !== 0 ? b[0] : void 0), p(b => { F.next({ panelPage: b }), F.complete(); })).subscribe(); }))), x(({ panelPage: n }) => this.cpm.getPlugins(n.panels.reduce((h, F) => (F.panes.forEach(j => { h.includes(j.contentPlugin) || h.push(j.contentPlugin); }), h), [])).pipe(l(() => ({ panelPage: n })))), x(({ panelPage: n }) => ve(() => !this.nested$.value, this.panelsContextService.allActivePageContexts({ panelPage: n }).pipe(l(h => ({ panelPage: n, contexts: Array.from(h) }))), V({ panelPage: n, contexts: [] }))), p(({ panelPage: n, contexts: h }) => { this.hookupFormChange({ panelPage: n }), this.populatePanelsFormArray({ panelPage: n }), this.panelPageCached = n, this.persistenceEnabled = n.persistence && n.persistence.dataduct && n.persistence.dataduct.plugin && n.persistence.dataduct.plugin !== "", this.filteredListeners = n.interactions && n.interactions.interactions && n.interactions.interactions.listeners ? n.interactions.interactions.listeners : [], this.renderLayout$.next(n), this.contexts$.next([...n.contexts ? n.contexts.map(F => new _e(F)) : [], ...h]), this.hookupCss({ file: n.cssFile ? n.cssFile.trim() : void 0 }), console.log(`cached panel page: ${n.id}`); })).subscribe(), this.hookupContextSub = U(this.contexts$, this.afterContentInit$).pipe(l(([n]) => n), x(n => this.inlineContextResolver.resolveMerged(n, `panelpage:${ye()}`).pipe(x(h => this.cxm.getPlugins().pipe(l(F => ({ contexts: n, resolvedContext: h, globalPlugins: Array.from(F.values()).filter(j => j.global === !0) })))), B(1))), p(() => { this.resolveSub && this.resolveSub.unsubscribe(); }), p(({ contexts: n, resolvedContext: h, globalPlugins: F }) => { this.resolvedContext = h; let j = new L; if (De(this.platformId)) {
            let b = setInterval(() => { s.registredContextListeners.size === 0 && (j.next(), j.complete(), clearInterval(b)); }, 1e3);
        } this.resolveSub = this.inlineContextResolver.resolveMergedSingle(n).pipe(Pe(F.length + (n ? n.length : 0)), p(() => s.registredContextListeners.add(this.instanceUniqueIdentity)), p(b => console.log("buffer", b)), yt(1), p(b => { b.length === 0 && s.registredContextListeners.delete(this.instanceUniqueIdentity); }), T(b => b.length !== 0), p(b => { this.contextsChanged = b.reduce((Z, [ee, Te]) => [...Z, ...Z.includes(ee) ? [] : [ee]], []), this.resolvedContext = b.reduce((Z, [ee, Te]) => k(N({}, Z), { [ee]: Te }), this.resolvedContext); }), p(() => s.registredContextListeners.delete(this.instanceUniqueIdentity)), De(this.platformId) ? Ct(j) : p(() => { })).subscribe(); })).subscribe(), this.renderLayoutSub = U([this.renderLayout$, this.afterViewInit$]).pipe(te(1), l(([n]) => ({ panelPage: n })), x(({ panelPage: n }) => this.lpm.getPlugin(n.layoutType).pipe(l(h => ({ panelPage: n, plugin: h })))), p(() => console.log("start render layout")), l(({ plugin: n, panelPage: h }) => ({ panelPage: h, plugin: n, viewContainerRef: this.layoutRendererHost.viewContainerRef })), p(({ viewContainerRef: n }) => n.clear()), l(({ plugin: n, viewContainerRef: h, panelPage: F }) => ({ panelPage: F, layoutRendererRef: h.createComponent(n.renderer) })), p(({ layoutRendererRef: n }) => this.layoutRendererRef = n), p(({ layoutRendererRef: n, panelPage: h }) => { n.instance.renderPanelTpl = this.renderPanelTpl, n.instance.panelPage = h; }), p(() => console.log("end render layout"))).subscribe(), this.stylizerSub = this.afterViewInit$.pipe(T(() => re(this.platformId)), p(() => { this.stylizerService.stylize({ targetNode: this.el.nativeElement }); })).subscribe(), this.classifySub = this.afterViewInit$.pipe(T(() => re(this.platformId)), p(() => { this.classifyService.classify({ targetNode: this.el.nativeElement }); })).subscribe(), this.stylizerMutatedSub = re(this.platformId) ? this.stylizerService.mutated$.pipe(J(2e3), Pe(1), x(({ stylesheet: n }) => this.authFacade.getUser$.pipe(l(h => ({ stylesheet: n, isAuthenticated: !!h })))), T(({ isAuthenticated: n }) => n), p(({ stylesheet: n }) => { console.log("merged css", n); }), T(() => !!this.panelPageCached && !!this.panelPageCached.id), x(({ stylesheet: n }) => this.isStable ? V({ stylesheet: n }) : this.ngZone.onStable.asObservable().pipe(l(() => ({ stylesheet: n })), B(1))), l(({ stylesheet: n }) => ({ stylesheet: (this.managedCssCache && this.managedCssCache.trim() !== "" ? this.managedCssCache + `
` : "") + n })), qe(({ stylesheet: n }) => this.fileService.bulkUpload({ nocache: !0, files: [new File([n], `panelpage__${this.panelPageCached.id}.css`)], fileNameOverride: `panelpage__${this.panelPageCached.id}.css` })), p(() => { console.log("stylesheet saved."); })).subscribe() : void 0, this.classifyMutatedSub = re(this.platformId) ? this.classifyService.mutated$.pipe(J(2e3), Pe(1), x(({ classes: n }) => this.authFacade.getUser$.pipe(l(h => ({ classes: n, isAuthenticated: !!h })))), T(({ isAuthenticated: n }) => n), p(({ classes: n }) => { console.log("merged classes", n); }), T(() => !!this.panelPageCached && !!this.panelPageCached.id), x(({ classes: n }) => this.isStable ? V({ classes: n }) : this.ngZone.onStable.asObservable().pipe(l(() => ({ classes: n })), B(1))), l(({ classes: n }) => ({ classes: Array.from(n.keys()).reduce((h, F) => k(N({}, h), { [F]: Array.from(n.get(F).keys()).filter(j => n.get(F).get(j) !== we.KEEP).reduce((j, b) => k(N({}, j), { [b]: n.get(F).get(b) }), {}) }), {}) })), l(({ classes: n }) => ({ classes: be(this.managedClassesCache, n) })), l(({ classes: n }) => ({ json: JSON.stringify(n) })), qe(({ json: n }) => this.fileService.bulkUpload({ nocache: !0, files: [new File([n], `panelpage__${this.panelPageCached.id}__classes.json`)], fileNameOverride: `panelpage__${this.panelPageCached.id}__classes.json` })), p(() => { console.log("classes saved."); })).subscribe() : void 0, this.onStableSub = this.ngZone.onStable.asObservable().pipe(p(() => this.isStable = !0)).subscribe(), this.onUnstableSub = this.ngZone.onUnstable.asObservable().pipe(p(() => this.isStable = !1)).subscribe(), this.wireListenersSub = U([this.listeners$, this.renderLayout$, this.afterContentInit$]).pipe(te(1), x(() => se(this.filteredListeners.map(n => V({}).pipe(l(() => ({ paramNames: n.event.settings.paramsString ? n.event.settings.paramsString.split("&").filter(h => h.indexOf("=:") !== -1).map(h => h.split("=", 2)[1].substr(1)) : [] })), x(({ paramNames: h }) => this.paramEvaluatorService.paramValues(n.event.settings.params.reduce((F, j, b) => new Map([...F, [h[b], j]]), new Map)).pipe(l(F => Array.from(F).reduce((j, [b, Z]) => k(N({}, j), { [b]: Z }), {})))), le([]))))), x(n => this.iepm.getPlugin("dom").pipe(l(h => ({ p: h, listenerParams: n })))), x(({ p: n, listenerParams: h }) => n.connect({ filteredListeners: this.filteredListeners, listenerParams: h, renderer: this.renderer, callback: ({ handlerParams: F, plugin: j, index: b, evt: Z }) => { this.ihpm.getPlugin(j).pipe(p(ee => { ee.handle({ handlerParams: F, plugin: j, index: b, listener: this.filteredListeners[b], evt: Z, renderer: this.renderer, panelPageComponent: this }); })).subscribe(); } })), p(n => { console.log("listener info", this.filteredListeners, n); })).subscribe(), this.onTouched = () => { }, this.panelPageService = me.getEntityCollectionService("PanelPage"), this.panelPageFormService = me.getEntityCollectionService("PanelPageForm"), this.panelPageStateService = me.getEntityCollectionService("PanelPageState");
    }
    ngOnInit() { this.onInit$.next(void 0); }
    ngAfterViewInit() { this.afterViewInit$.next(void 0); }
    ngAfterContentInit() { this.afterContentInit$.next(void 0); }
    ngOnDestroy() { s.registredContextListeners.delete(this.instanceUniqueIdentity); }
    populatePanelsFormArray({ panelPage: o }) { this.panelsArray.clear(), o.panels.forEach(() => { this.panelsArray.push(this.fb.control("")); }); }
    hookupFormChange({ panelPage: o }) { U([this.pageForm.valueChanges, this.pageForm.statusChanges]).pipe(J(100), T(([t, i]) => o !== void 0 && o.displayType === "form" && i !== "PENDING")).subscribe(([t]) => { let i = this.pageForm.valid, r = this.panelPageCached.persistence ? this.panelPageCached.persistence : void 0, d = new He(k(N({}, t), { name: o.name, title: o.title, derivativeId: o.id, persistence: r, valid: i })); this.pageBuilderFacade.setForm(o.name, d); }); }
    hookupCss({ file: o }) { se([V(void 0), V(void 0), V(void 0), this.panelPageCached.id ? this.http.get(`${this.mediaSettings.imageUrl}/media/panelpage__${this.panelPageCached.id}__classes.json`).pipe(Pt(() => V(void 0)), le(void 0)) : V(void 0)]).pipe(p(([t, i, r, d]) => { console.log("fetched managed panelpage css and class files"); let m = {}; this.managedCssCache = "", this.managedClassesCache = d, t && (m = be(m, t)), i && (this.managedCssCache = r, m = be(m, i)), this.filteredCss = { css: m, classes: d }; })).subscribe(); }
    submit() { if (this.pageForm.valid) {
        let o = new He(N({}, this.pageForm.value)), t = this.formService.serializeForm(o);
        console.log(o), console.log(this.formService.serializeForm(o)), console.log("form data", t), this.persistService.persist({ data: t, persistence: this.panelPageCached.persistence }).subscribe(() => { console.log("persisted data"); });
    }
    else
        console.log("detected form invalid"); }
    writeValue(o) { o && this.settingsFormArray.setValue(o, { emitEvent: !1 }); }
    registerOnChange(o) { this.settingsFormArray.valueChanges.subscribe(o); }
    registerOnTouched(o) { this.onTouched = o; }
    setDisabledState(o) { o ? this.settingsFormArray.disable() : this.settingsFormArray.enable(); }
    validate(o) { return this.pageForm.statusChanges.pipe(Fe(this.pageForm.status), T(t => t !== "PENDING"), J(1), B(1), l(t => this.pageForm.valid ? null : { invalidForm: { valid: !1, message: "content is invalid" } })); }
    static { this.\u0275fac = function (t) { return new (t || s)(e.\u0275\u0275directiveInject(Ie), e.\u0275\u0275directiveInject(ft), e.\u0275\u0275directiveInject(Re.Store), e.\u0275\u0275directiveInject(R.UntypedFormBuilder), e.\u0275\u0275directiveInject(e.ElementRef), e.\u0275\u0275directiveInject(ue.InlineContextResolverService), e.\u0275\u0275directiveInject(w.PageBuilderFacade), e.\u0275\u0275directiveInject(je.ContentPluginManager), e.\u0275\u0275directiveInject(ue.ContextPluginManager), e.\u0275\u0275directiveInject(Ke.LayoutPluginManager), e.\u0275\u0275directiveInject(e.ComponentFactoryResolver), e.\u0275\u0275directiveInject(ie.StyleLoaderService), e.\u0275\u0275directiveInject(Xe.HttpClient), e.\u0275\u0275directiveInject(w.CssHelperService), e.\u0275\u0275directiveInject(et.AttributeSerializerService), e.\u0275\u0275directiveInject(w.FormService), e.\u0275\u0275directiveInject(w.PanelsContextService), e.\u0275\u0275directiveInject(ie.AsyncApiCallHelperService), e.\u0275\u0275directiveInject(Ee.CrudDataHelperService), e.\u0275\u0275directiveInject(X.EntityDefinitionService), e.\u0275\u0275directiveInject(e.NgZone), e.\u0275\u0275directiveInject(Me.PersistService), e.\u0275\u0275directiveInject(ge.StylizerService), e.\u0275\u0275directiveInject(ge.ClassifyService), e.\u0275\u0275directiveInject(Ze.FilesService), e.\u0275\u0275directiveInject(tt.AuthFacade), e.\u0275\u0275directiveInject(Ne.ParamEvaluatorService), e.\u0275\u0275directiveInject(e.Renderer2), e.\u0275\u0275directiveInject(ne.InteractionEventPluginManager), e.\u0275\u0275directiveInject(ne.InteractionHandlerPluginManager), e.\u0275\u0275directiveInject(X.EntityServices)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: s, selectors: [["classifieds-ui-panel-page"]], viewQuery: function (t, i) { if (t & 1 && (e.\u0275\u0275viewQuery(ut, 5), e.\u0275\u0275viewQuery(Lt, 7), e.\u0275\u0275viewQuery(Be, 5), e.\u0275\u0275viewQuery(xe, 5)), t & 2) {
            let r;
            e.\u0275\u0275queryRefresh(r = e.\u0275\u0275loadQuery()) && (i.gridLayout = r.first), e.\u0275\u0275queryRefresh(r = e.\u0275\u0275loadQuery()) && (i.renderPanelTpl = r.first), e.\u0275\u0275queryRefresh(r = e.\u0275\u0275loadQuery()) && (i.layoutRendererHost = r.first), e.\u0275\u0275queryRefresh(r = e.\u0275\u0275loadQuery()) && (i.renderedPanels = r);
        } }, hostVars: 2, hostBindings: function (t, i) { t & 2 && e.\u0275\u0275classProp("panel-page", !0); }, inputs: { id: "id", panelPage: "panelPage", nested: "nested", contexts: "contexts", ancestory: "ancestory", css: "css", listeners: "listeners", resolvedContext: "resolvedContext" }, standalone: !1, features: [e.\u0275\u0275ProvidersFeature([{ provide: he, useExisting: W(() => s), multi: !0 }, { provide: $e, useExisting: W(() => s), multi: !0 }])], decls: 5, vars: 1, consts: [["renderPanelTpl", ""], [3, "formGroup"], ["classifiedsUiLayoutRendererHost", ""], ["formArrayName", "panels"], [3, "formControlName", "panel", "nested", "contexts", "resolvedContext", "contextsChanged", "displayType", "indexPosition", "css", "listeners", "ancestory"]], template: function (t, i) { t & 1 && (e.\u0275\u0275elementStart(0, "div", 1), e.\u0275\u0275elementContainerStart(1), e.\u0275\u0275template(2, Ht, 0, 0, "ng-template", 2), e.\u0275\u0275elementContainerEnd(), e.\u0275\u0275elementEnd(), e.\u0275\u0275template(3, Vt, 3, 12, "ng-template", null, 0, e.\u0275\u0275templateRefExtractor)), t & 2 && e.\u0275\u0275property("formGroup", i.pageForm); }, dependencies: [R.NgControlStatus, R.NgControlStatusGroup, R.FormGroupDirective, R.FormControlName, R.FormArrayName, xe, Be], styles: ["[_nghost-%COMP%]     gridster{background-color:#fff}[_nghost-%COMP%]     gridster-item{background-color:#fff}"] }); }
}, Ii = (() => { class s {
    static { this.\u0275fac = function (i) { return new (i || s); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: s, selectors: [["classifieds-ui-empty-layout"]], standalone: !1, decls: 1, vars: 0, template: function (i, r) { i & 1 && e.\u0275\u0275text(0, "empty layout content"); }, encapsulation: 2 }); }
} return s; })(), qt = (() => { class s {
    constructor(t, i) { this.dialog = i, this.panelPageId = t.panelPageId || ""; }
    onClose() { this.dialog.closeAll(); }
    static { this.\u0275fac = function (i) { return new (i || s)(e.\u0275\u0275directiveInject(It), e.\u0275\u0275directiveInject(K.MatDialog)); }; }
    static { this.\u0275cmp = e.\u0275\u0275defineComponent({ type: s, selectors: [["quell-render-dialog"]], standalone: !1, decls: 7, vars: 1, consts: [["mat-dialog-title", ""], [3, "id"], ["mat-button", "", 3, "click"]], template: function (i, r) { i & 1 && (e.\u0275\u0275elementStart(0, "h2", 0), e.\u0275\u0275text(1, "Panel Page"), e.\u0275\u0275elementEnd(), e.\u0275\u0275elementStart(2, "mat-dialog-content"), e.\u0275\u0275element(3, "classifieds-ui-panel-page", 1), e.\u0275\u0275elementEnd(), e.\u0275\u0275elementStart(4, "mat-dialog-actions")(5, "button", 2), e.\u0275\u0275listener("click", function () { return r.onClose(); }), e.\u0275\u0275text(6, "Close"), e.\u0275\u0275elementEnd()()), i & 2 && (e.\u0275\u0275advance(3), e.\u0275\u0275property("id", r.panelPageId)); }, dependencies: [nt.MatButton, K.MatDialogTitle, K.MatDialogActions, K.MatDialogContent, Y], encapsulation: 2 }); }
} return s; })(), ae = new Map, oe = new Map, Ut = ({ pageBuilderFacade: s, formService: o, persistService: t, transversePanelpageComponentSvc: i }) => new it({ id: "panels_form_submit", title: "Submit Panels Form", handle: ({ handlerParams: r, panelPageComponent: d }) => { let m = r?.name; if (!m) {
        console.log("No form name provided. Ignoring submission request.");
        return;
    } if (oe.get(m)) {
        console.log(`Form submission is already being processed for: ${m}`);
        return;
    } if (ae.get(m)) {
        console.log(`Form submission for ${m} is throttled. Try again later.`);
        return;
    } oe.set(m, !0), console.log(`Processing form submission for: ${m}`), s.getForm$(m).pipe(B(1), p(A => { if (!A) {
        console.log(`Form ${m} not found.`);
        return;
    } if (A.valid) {
        let O = o.serializeForm(A);
        console.log("Panel Page Form Data:", O), t.persist({ data: O, persistence: A.persistence }).subscribe({ next: () => { console.log("Form Submitted successfully:", m), alert("Form Submitted"); }, error: G => { console.error("Error persisting form: ", G); }, complete: () => { console.log("Form submission complete for:", m); } });
    }
    else
        i.traverseAndVisit(d, O => { O instanceof pe && O.componentRef && O.componentRef.instance && O.componentRef.instance.markAsTouched && O.componentRef.instance.markAsTouched(); }), console.log("Form is invalid or unavailable. Skipping processing for:", m); }), bt(() => { oe.delete(m), ae.set(m, !0), Oe(2e3).subscribe(() => { ae.delete(m); }), console.log(`Throttle applied for form: ${m}`); })).subscribe({ error: A => { console.error(`Error occurred during form submission for ${m}:`, A), oe.delete(m), ae.delete(m); } }); } }), kt = ({ dialog: s }) => new it({ id: "panels_dialog", title: "Open Panels Dialog", handle: ({ handlerParams: o }) => { let t = o?.panelPageId || "", i = o?.title || "Panel Page", r = o?.width || "800px"; if (!t) {
        console.error("No Panel Page ID provided. Cannot open dialog.");
        return;
    } s.open(qt, { width: r, data: { panelPageId: t, title: i } }); } }), Bt = (() => { class s extends St {
    shouldReuseRoute(t, i) { return !0; }
    static { this.\u0275fac = (() => { let t; return function (r) { return (t || (t = e.\u0275\u0275getInheritedFactory(s)))(r || s); }; })(); }
    static { this.\u0275prov = e.\u0275\u0275defineInjectable({ token: s, factory: s.\u0275fac }); }
} return s; })(), Gt = (() => { class s {
    traverseAndVisit(t, i) { t && (i(t), t instanceof Y ? t.renderedPanels.forEach(r => { this.traverseAndVisit(r, i); }) : t instanceof xe ? t.renderedPanes.forEach(r => { this.traverseAndVisit(r, i); }) : t instanceof pe && t.panelPageComponent && this.traverseAndVisit(t.panelPageComponent, i)); }
    static { this.\u0275fac = function (i) { return new (i || s); }; }
    static { this.\u0275prov = e.\u0275\u0275defineInjectable({ token: s, factory: s.\u0275fac, providedIn: "root" }); }
} return s; })(), $i = (() => { class s {
    constructor(t, i, r, d, m, A) { t.register(Ut({ pageBuilderFacade: i, formService: r, persistService: d, transversePanelpageComponentSvc: A })), t.register(kt({ dialog: m })); }
    static { this.\u0275fac = function (i) { return new (i || s)(e.\u0275\u0275inject(ne.InteractionHandlerPluginManager), e.\u0275\u0275inject(w.PageBuilderFacade), e.\u0275\u0275inject(w.FormService), e.\u0275\u0275inject(Me.PersistService), e.\u0275\u0275inject(K.MatDialog), e.\u0275\u0275inject(Gt)); }; }
    static { this.\u0275mod = e.\u0275\u0275defineNgModule({ type: s }); }
    static { this.\u0275inj = e.\u0275\u0275defineInjector({ providers: [{ provide: ht, useValue: Se, multi: !0 }, { provide: xt, useClass: Bt }], imports: [at, ct, pt, dt, mt, gt, $t] }); }
} return s; })();
export { Ii as EmptyLayoutComponent, Y as PanelPageComponent, Se as PanelPageRouterComponent, $i as RenderModule, pe as RenderPaneComponent, xe as RenderPanelComponent, Gt as TransversePanelPageComponentService };
